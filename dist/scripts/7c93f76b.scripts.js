"use strict";angular.module("zupPainelApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","restangular","infinite-scroll","colorpicker.module","frapontillo.bootstrap-switch","angularFileUpload"]).config(["$routeProvider","$httpProvider","RestangularProvider",function(a,b,c){a.when("/",{templateUrl:"views/login.html",controller:"MainCtrl"}).when("/groups",{templateUrl:"views/groups/index.html",controller:"GroupsCtrl",access:{logged:!0}}).when("/groups/add",{templateUrl:"views/groups/add.html",controller:"GroupsCtrl",access:{logged:!0}}).when("/groups/:id",{templateUrl:"views/groups/list.html",controller:"ViewGroupsCtrl",access:{logged:!0}}).when("/users",{templateUrl:"views/users/index.html",controller:"UsersCtrl",access:{logged:!0}}).when("/users/group/:groupId",{templateUrl:"views/users/index.html",controller:"UsersCtrl",access:{logged:!0}}).when("/users/:id",{templateUrl:"views/users/view.html",controller:"ViewUsersCtrl",access:{logged:!0}}).when("/users/add",{templateUrl:"views/users/add.html",controller:"UserCtrl",access:{logged:!0}}).when("/reports",{templateUrl:"views/reports/index.html",controller:"ReportsCtrl",access:{logged:!0}}).when("/reports/categories",{templateUrl:"views/reports/categories.html",controller:"ReportsCategoriesCtrl",access:{logged:!0}}).when("/reports/categories/new",{templateUrl:"views/reports/editCategory.html",controller:"ReportsCategoriesEditCtrl",access:{logged:!0}}).when("/reports/categories/:id/edit",{templateUrl:"views/reports/editCategory.html",controller:"ReportsCategoriesEditCtrl",access:{logged:!0}}).when("/reports/categories/:categoryId/item/:id",{templateUrl:"views/reports/view.html",controller:"ReportsCategoriesItemCtrl",access:{logged:!0}}).when("/inventories",{templateUrl:"views/inventories/index.html",controller:"InventoriesCtrl",access:{logged:!0}}).when("/inventories/edit/:id",{templateUrl:"views/inventories/edit.html",controller:"InventoriesCtrl",access:{logged:!0}}).when("/items",{templateUrl:"views/items/index.html",controller:"ItemsCtrl",resolve:{isMap:function(){return!1}},access:{logged:!0}}).when("/items/map",{templateUrl:"views/items/map.html",controller:"ItemsCtrl",resolve:{isMap:function(){return!0}},access:{logged:!0}}).when("/items/search",{templateUrl:"views/items/search.html",controller:"ItemsCtrl",access:{logged:!0}}).when("/inventories/:categoryId/item/:id",{templateUrl:"views/items/view.html",controller:"ViewItemCtrl",access:{logged:!0}}).when("/tags",{templateUrl:"views/tags/index.html",controller:"TagsCtrl",access:{logged:!0}}).otherwise({redirectTo:"/"}),b.interceptors.push(["$q","$injector",function(a,b){return{request:function(c){c.url=c.url.replace("{base_url}","http://staging.zup.sapience.io");var d=null;return b.invoke(["Auth",function(a){d=a.getToken()}]),c.headers["X-App-Token"]=d,c||a.when(c)},responseError:function(c){var d=[400];return("undefined"==typeof d||-1===d.indexOf(c.status))&&b.invoke(["Error",function(a){a.showDetails(c)}]),a.reject(c)}}}]),b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"],c.setBaseUrl("http://staging.zup.sapience.io"),c.setFullResponse(!0),c.setResponseExtractor(function(a,b,c){if("undefined"!=typeof a[c])return a[c];for(var d in a)return a[d];return a}),c.setRequestInterceptor(function(a,b){return"remove"===b?null:a})}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(d,e,f){if("undefined"==typeof f&&(a.isLoading=!0),"undefined"!=typeof e.access&&e.access.logged===!0){var g=c.check();g.then(function(){a.isLoading=!1},function(){a.isLoading=!1,b.path("/")})}else a.isLoading=!1})}]),angular.module("zupPainelApp").controller("MainCtrl",["User","Error","$scope","$location","Auth",function(a,b,c,d,e){var f=e.getToken();null!==f&&d.path("/reports"),c.login=function(){c.loginError=!1;var b=new a(c.email,c.password);b.auth().then(function(){d.path("/reports")},function(a){(400==a.status||401==a.status)&&(c.loginError=!0)})}}]),angular.module("zupPainelApp").controller("GroupsCtrl",["$scope","$modal","Groups",function(a,b,c){a.loading=!0;var d={},e=c.getAll(function(b){a.groups=b.groups,a.loading=!1});a.search=function(b){""===b?delete d.name:d.name=b,a.loadingContent=!0,e=c.getAll(d,function(b){a.groups=b.groups,a.loadingContent=!1})},a.deleteGroup=function(d){b.open({templateUrl:"removeGroup.html",windowClass:"removeModal",resolve:{groupsList:function(){return a.groups}},controller:["$scope","$modalInstance","groupsList",function(a,b,e){a.group=d,a.confirm=function(){var d=c.get({id:a.group.id},function(){d.$delete({id:a.group.id},function(){b.close(),e.splice(e.indexOf(a.group),1)})})},a.close=function(){b.close()}}]})}}]).controller("ViewGroupsCtrl",["$scope","Groups","$routeParams",function(a,b,c){a.loading=!0,b.getUsers({id:c.id},function(b){a.group=b.group,a.users=b.users,a.loading=!1})}]),angular.module("zupPainelApp").controller("UsersCtrl",["$scope","$q","$routeParams","$modal","Restangular",function(a,b,c,d,e){a.loading=!0;var f,g=c.groupId,h=1,i=30,j="",k=!1,l=function(b,c){return"undefined"!=typeof b?(a.groupId=b,""!=c?e.one("search").one("groups",b).all("users").getList({name:c,email:c,page:h,per_page:i}):e.one("groups",b).all("users").getList({page:h,per_page:i})):(b=a.groupId=null,""!=c?e.one("search").all("users").getList({name:c,email:c,page:h,per_page:i}):e.all("users").getList({page:h,per_page:i}))},m=e.all("groups").getList(),n=a.getData=function(c){if(k===!1){k=!0;var d=l(g,j);return b.all([d,m]).then(function(b){if(a.groups=b[1].data,c!==!0)a.users=b[0].data;else{"undefined"==typeof a.users&&(a.users=[]);for(var d=0;d<b[0].data.length;d++)a.users.push(b[0].data[d]);h++}f=parseInt(b[0].headers().total);var e=Math.ceil(f/i);k=h===e+1?null:!1,a.loading=!1}),d}};a.search=function(b){j=b,h=1,k=!1,a.loadingContent=!0,n().then(function(){a.loadingContent=!1,h++})},a.deleteUser=function(b){d.open({templateUrl:"removeUser.html",windowClass:"removeModal",resolve:{usersList:function(){return a.users}},controller:["$scope","$modalInstance","Users","usersList",function(a,c,d,e){a.user=b,a.confirm=function(){var b=d.get({id:a.user.id},function(){b.$delete({id:a.user.id},function(){c.close(),e.splice(e.indexOf(a.user),1)})})},a.close=function(){c.close()}}]})}}]).controller("ViewUsersCtrl",["$scope","Restangular","$routeParams",function(a,b,c){a.loading=!0,b.one("users",c.id).get().then(function(b){a.user=b,a.loading=!1})}]),angular.module("zupPainelApp").controller("ReportsCtrl",["$scope","Restangular","$modal","$q",function(a,b,c,d){a.loading=!0;{var e,f=1,g=30,h="",i=!1,j=function(a){return""!=a?b.one("search").all("items").getList({name:a,email:a,page:f,per_page:g}):b.one("reports").all("items").getList({page:f,per_page:g})},k=b.one("reports").all("categories").getList();a.getData=function(b){if(i===!1){i=!0;var c=j(h);return d.all([c,k]).then(function(c){if(a.categories=c[1].data,b!==!0)a.reports=c[0].data;else{"undefined"==typeof a.reports&&(a.reports=[]);for(var d=0;d<c[0].data.length;d++)a.reports.push(c[0].data[d]);f++}e=parseInt(c[0].headers().total);var h=Math.ceil(e/g);i=f===h+1?null:!1,a.loading=!1}),c}}}a.getReportCategory=function(b){for(var c=a.categories.length-1;c>=0;c--)if(a.categories[c].id===b)return a.categories[c];return null},a.deleteReport=function(d){c.open({templateUrl:"views/reports/removeReport.html",windowClass:"removeModal",resolve:{reportsList:function(){return a.reports},report:function(){return d}},controller:["$scope","$modalInstance","reportsList","report",function(a,c,d,e){a.report=e,a.confirm=function(){var e=b.one("reports").one("items",a.report.id).remove();e.then(function(){c.close(),d.splice(d.indexOf(a.report),1)})},a.close=function(){c.close()}}]})}}]).controller("ReportsCategoriesCtrl",["$scope","Restangular","$modal",function(a,b,c){a.loading=!0;var d=b.one("reports").all("categories").getList();d.then(function(b){a.categories=b.data,a.loading=!1}),a.deleteCategory=function(d){c.open({templateUrl:"views/reports/removeCategory.html",windowClass:"removeModal",resolve:{reportsCategoriesList:function(){return a.categories}},controller:["$scope","$modalInstance","reportsCategoriesList",function(a,c,e){a.category=d,a.confirm=function(){var d=b.one("reports").one("categories",a.category.id).remove();d.then(function(){c.close(),e.splice(e.indexOf(a.category),1)})},a.close=function(){c.close()}}]})}}]).controller("ReportsCategoriesItemCtrl",["$scope","Restangular","$routeParams","$q",function(a,b,c,d){a.loading=!0;var e=b.one("reports").one("items",c.id).get(),f=b.one("reports").all("categories").getList();d.all([e,f]).then(function(b){a.report=b[0].data;for(var d=b[1].data.length-1;d>=0;d--)b[1].data[d].id==c.categoryId&&(a.category=b[1].data[d]);a.loading=!1})}]).controller("ReportsCategoriesEditCtrl",["$scope","$routeParams","Restangular","$fileUploader","$q","$location","$modal",function(a,b,c,d,e,f,g){var h=a.updating=!1,i=b.id;"undefined"!=typeof i&&(h=!0,a.updating=!0),a.loading=!0;var j=c.one("inventory").all("categories").getList();if(h){var k=a.category={},l=c.one("reports").one("categories",i).get();e.all([j,l]).then(function(b){if(a.categories=b[0].data,k.title=b[1].data.title,k.color=b[1].data.color,k.allows_arbitrary_position=b[1].data.allows_arbitrary_position,k.statuses=b[1].data.statuses,null!==b[1].data.user_response_time&&(a.enabled_user_response_time=!0,k.user_response_time=b[1].data.user_response_time),null!==b[1].data.resolution_time&&(k.resolution_time=b[1].data.resolution_time),"object"==typeof b[1].data.inventory_categories&&0!==b[1].data.inventory_categories.length){k.inventory_categories=[];for(var c=b[1].data.inventory_categories.length-1;c>=0;c--)k.inventory_categories.push(b[1].data.inventory_categories[c].id)}a.icon=b[1].data.icon.default.web.active,a.loading=!1})}else{j.then(function(b){a.categories=b.data,a.loading=!1}),a.enabled_user_response_time=!1;var k=a.category={marker:"R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",inventory_categories:[],allows_arbitrary_position:!0,statuses:[{title:"Em aberto",color:"#ff0000",initial:!0,"final":!1},{title:"Em andamento",color:"#ff0000",initial:!1,"final":!1},{title:"Resolvido",color:"#ff0000",initial:!1,"final":!0}]}}a.manageStatuses=function(){g.open({templateUrl:"views/reports/manageStatuses.html",windowClass:"manageStatuses",resolve:{category:function(){return a.category}},controller:["$scope","$modalInstance","category",function(a,b,c){a.category=c,a.newStatus={},a.createStatus=function(){""!==a.newStatus.title&&(a.category.statuses.push({title:a.newStatus.title,color:"#FFFFFF",initial:"false","final":"false"}),a.newStatus.title="")},a.changeInitial=function(b){for(var c=a.category.statuses.length-1;c>=0;c--)b!=a.category.statuses[c]&&(a.category.statuses[c].initial=!1);b.initial=!0},a.removeStatus=function(b){a.category.statuses.splice(a.category.statuses.indexOf(b),1)},a.close=function(){b.close()}}]})},a.manageStatuses();var m=a.uploader=d.create({scope:a,filters:[function(){return m.queue=[],!0}]});m.filters.push(function(a){var b=m.isHTML5?a.type:"/"+a.value.slice(a.value.lastIndexOf(".")+1);return b="|"+b.toLowerCase().slice(b.lastIndexOf("/")+1)+"|",-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}),a.send=function(){function b(a){var b=e.defer(),a=a,c=new FileReader;return c.addEventListener("load",function(a){var c=a.target;d=c.result.replace(/^data:image\/[^;]+;base64,/,""),b.resolve()}),c.readAsDataURL(a),b.promise}a.inputErrors=null,a.processingForm=!0;for(var d,g=[],j=m.queue.length-1;j>=0;j--)g.push(b(m.queue[j].file));e.all(g).then(function(){var b=k.statuses;k.statuses={};for(var e=b.length-1;e>=0;e--)b[e].initial=b[e].initial.toString(),b[e].final=b[e].initial.toString(),k.statuses[e]=b[e];if(h){a.updated=!1,d&&(k.icon=d);var g=c.one("reports").one("categories",i).customPUT(k);g.then(function(){a.updated=!0,a.processingForm=!1},function(b){a.inputErrors=b.data.error,a.processingForm=!1})}else{k.icon=d,k.marker=d;var g=c.one("reports").post("categories",k);g.then(function(){f.path("/reports/categories"),a.processingForm=!1},function(b){a.inputErrors=b.data.error,a.processingForm=!1})}})}}]),angular.module("zupPainelApp").controller("InventoriesCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("zupPainelApp").controller("ItemsCtrl",["$scope","$modal","Inventories","$q","Restangular","isMap",function(a,b,c,d,e,f){a.loading=!0;var g,h=1,i=30,j="",k=!1,l=function(a){return""!=a?e.one("search").all("items").getList({name:a,email:a,page:h,per_page:i}):e.one("inventory").all("items").getList({page:h,per_page:i})},m=e.one("inventory").all("categories").getList(),n=a.getData=function(b){if(k===!1){k=!0;var c=l(j);return d.all([c,m]).then(function(c){if(a.categories=c[1].data,b!==!0)a.items=c[0].data;else{"undefined"==typeof a.items&&(a.items=[]);for(var d=0;d<c[0].data.length;d++)a.items.push(c[0].data[d]);h++}g=parseInt(c[0].headers().total);var e=Math.ceil(g/i);k=h===e+1?null:!1,a.loading=!1}),c}};f===!0&&n(),a.getInventoryCategory=function(b){for(var c=a.categories.length-1;c>=0;c--)if(a.categories[c].id===b)return a.categories[c];return null},a.deleteItem=function(c,d){b.open({templateUrl:"views/items/removeItem.html",windowClass:"removeModal",resolve:{itemsList:function(){return a.items},item:function(){return c},category:function(){return d}},controller:["$scope","$modalInstance","itemsList","item","category",function(a,b,c,d,f){a.item=d,a.category=f,a.confirm=function(){var d=e.one("inventory").one("categories",a.category.id).one("items",a.item.id).remove();d.then(function(){b.close(),c.splice(c.indexOf(a.item),1)})},a.close=function(){b.close()}}]})}}]).controller("ViewItemCtrl",["$scope","Restangular","$routeParams","$q",function(a,b,c,d){a.loading=!0;var e=b.one("inventory").one("categories",c.categoryId).one("items",c.id).get(),f=b.one("inventory").one("categories",c.categoryId).get({display_type:"full"});d.all([e,f]).then(function(b){a.item=b[0].data,a.category=b[1].data,a.loading=!1}),a.getDataByInventoryFieldId=function(b){for(var c=a.item.data.length-1;c>=0;c--)if(a.item.data[c].inventory_field_id===b)return a.item.data[c].content}}]),angular.module("zupPainelApp").directive("bootstrapSwitch",function(){return{link:function(a,b){b.bootstrapSwitch()}}}),angular.module("zupPainelApp").directive("mapItems",["$timeout","$q","$rootScope","Inventories","$compile",function(a,b,c,d,e){return{restrict:"A",link:function(f,g){var h={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:11,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},zoomLevels:{},currentZoom:11,map:null,getNewItemsTimeout:null,hideNotVisibleMarkersTimeout:null,doAnimation:!0,activeMethod:"reports",activeInventoryFilters:[],hiddenReportsCategories:[],hiddenInventoryCategories:[],mainMarker:null,allows_arbitrary_position:!0,infoWindow:new google.maps.InfoWindow,start:function(){this.createMap(),this.setListeners()},createMap:function(){this.zoomLevels={},this.currentZoom=11;var a=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(g[0],this.options.map),this.map.mapTypes.set("zup",a),this.map.setMapTypeId("zup"),this.map.setCenter(this.options.homeLatlng)},setListeners:function(){f.$watch("categoryData",function(){h.createMap(),setTimeout(function(){google.maps.event.trigger(h.map,"resize"),google.maps.event.trigger(h.map,"bounds_changed"),h.map.setCenter(h.options.homeLatlng),google.maps.event.addListener(h.map,"bounds_changed",function(){h.boundsChanged()}),google.maps.event.trigger(h.map,"bounds_changed")},80)})},getItems:function(a){var b={"position[latitude]":a.center.lat(),"position[longitude]":a.center.lng(),"position[distance]":a.distance,limit:80,zoom:h.map.getZoom()},c=d.getItems(b);return c},boundsChanged:function(){var d=!1;"undefined"==typeof this.zoomLevels[this.map.getZoom()]&&(this.zoomLevels[this.map.getZoom()]={}),this.currentZoom!==this.map.getZoom()&&(d=!0,this.currentZoom=this.map.getZoom()),this.hideNotVisibleMarkersTimeout&&a.cancel(this.hideNotVisibleMarkersTimeout),this.hideNotVisibleMarkersTimeout=a(function(){h.hideNotVisibleMarkers()},200),this.getNewItemsTimeout&&a.cancel(this.getNewItemsTimeout),c.isLoadingItems=!0,this.getNewItemsTimeout=a(function(){var a=h.getItems({center:h.map.getCenter(),distance:h.getDistance(),limit:100});b.all([a.$promise]).then(function(a){c.isLoadingItems=!1,d&&h.hideAllMarkersFromInactiveLevels();for(var b=a[0].items.length-1;b>=0;b--)h.addMarker(a[0].items[b],h.doAnimation,"item");h.doAnimation===!0&&(h.doAnimation=!1)})},1e3)},hideNotVisibleMarkers:function(){angular.forEach(this.zoomLevels[this.map.getZoom()],function(a){if(h.isMarkerInsideBounds(a)){var b;"report"===a.type&&(b=h.hiddenReportsCategories.indexOf(a.item.category_id)),"item"===a.type&&(b=h.hiddenInventoryCategories.indexOf(a.item.inventory_category_id)),~b||a.setVisible(!0)}else a.setVisible(!1)})},hideAllMarkersFromInactiveLevels:function(){angular.forEach(this.zoomLevels,function(a,b){console.log(b,h.currentZoom),b!=h.currentZoom&&angular.forEach(a,function(a){a.setVisible(!1)})})},isMarkerInsideBounds:function(a){return this.map.getBounds().contains(a.getPosition())},addMarker:function(a,b,c){if("undefined"==typeof this.zoomLevels[this.map.getZoom()][c+"_"+a.id]){var d=new google.maps.LatLng(a.position.latitude,a.position.longitude),g=h.infoWindow,i=f.getInventoryCategory(a.inventory_category_id),j=new google.maps.Size(15,15),k="item",l=(h.hiddenInventoryCategories.indexOf(a.inventory_category_id),new google.maps.MarkerImage(i.pin.retina.web,null,null,null,j)),m={position:d,map:this.map,icon:l,category:i,item:a,type:k};"undefined"!=typeof b&&b===!0&&(m.animation=google.maps.Animation.DROP);var n=new google.maps.Marker(m);this.zoomLevels[this.map.getZoom()][c+"_"+a.id]=n,google.maps.event.addListener(n,"click",function(){var a='<div class="pinTooltip"><h1>{{category.title}}</h1><p>Enviada {{ item.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="#/inventories/{{ category.id }}/item/{{ item.id }}">Ver detalhes</a></div>',b=f.$new(!0);b.category=this.category,b.item=this.item;var c=e(a)(b);b.$apply(),g.setContent(c[0]),g.open(h.map,this)})}},getDistance:function(){var a=this.map.getBounds(),b=a.getCenter(),c=a.getNorthEast(),d=google.maps.geometry.spherical.computeDistanceBetween(b,c);return d}};h.start(),f.mapProvider=h}}}]),angular.module("zupPainelApp").controller("TagsCtrl",["$scope","$modal",function(a,b){a.open=function(){b.open({templateUrl:"addTag.html",windowClass:"tagModal",controller:["$scope","$modalInstance",function(a,b){a.ok=function(){b.close()}}]})}}]),angular.module("zupPainelApp").service("User",["$q","$http","Auth",function(a,b,c){return function(d,e){this.auth=function(){var f=a.defer(),g=b({method:"POST",url:"{base_url}/authenticate.json",data:{email:d,password:e},expectedErrors:[400,401]});return g.success(function(a){c.saveUser(a.user),c.saveToken(a.token),f.resolve()}),g.error(function(a,b,c,d){f.reject({data:a,status:b,config:d})}),f.promise}}}]),angular.module("zupPainelApp").factory("Auth",["$q","$http","$cookies","$rootScope",function(a,b,c,d){var e=null;return{check:function(){var c=a.defer(),d=this.getToken();if(null!==d&&null===e){var f=b({method:"GET",url:"{base_url}/me.json",headers:{"X-App-Token":d}}),g=this;f.success(function(a){g.saveUser(a.user),c.resolve()}),f.error(function(){c.reject(),g.clearToken()})}else null!==d&&null!==e?c.resolve():(c.reject(),this.clearToken());return c.promise},getToken:function(){var a=c.token;return"undefined"==typeof a?null:a},saveToken:function(a){c.token=a},clearToken:function(){delete c.token},saveUser:function(a){e=a,d.me=e},isLogged:function(){return null!==e&&null!==this.getToken()}}}]),angular.module("zupPainelApp").factory("Error",["$modal",function(a){return{showDetails:function(b){a.open({templateUrl:"views/modal_error.html",resolve:{response:function(){return b}},controller:["$scope","$modalInstance","response",function(a,b,c){a.response=c,a.ok=function(){window.location.reload()}}]})}}}]),angular.module("zupPainelApp").factory("Groups",["$resource",function(a){return a("{base_url}/groups/:id.json",{id:"@id"},{update:{method:"PUT"},getAll:{method:"GET"},getUsers:{url:"{base_url}/groups/:id/users.json",method:"GET",params:{id:"@id"}}})}]),angular.module("zupPainelApp").factory("Users",["$resource",function(a){return a("{base_url}/users/:id.json",{id:"@id"},{update:{method:"PUT"},getAll:{method:"GET"}})}]),angular.module("zupPainelApp").directive("hackSidebarHeight",function(){return{link:function(a,b){a.$watch(function(){return angular.element(document).height()},function(a){b.height(a)})}}}),angular.module("zupPainelApp").factory("Reports",["$resource",function(a){return a("{base_url}/reports/categories/:id.json",{id:"@id"},{getItemsByCategory:{url:"{base_url}/reports/:categoryId/items.json",method:"GET",params:{categoryId:"@categoryId"}},getItem:{url:"{base_url}/reports/items/:id.json",params:{id:"@id"}}})}]),angular.module("zupPainelApp").directive("keyboardPoster",["$parse","$timeout",function(a,b){var c=700;return function(d,e,f){var g=angular.element(e)[0],h=null;g.onkeydown=function(){var g=a(f.keyboardPoster),i=g(d);h&&b.cancel(h),h=b(function(){i(e.val())},c)}}}]),angular.module("zupPainelApp").factory("Inventories",["$resource",function(a){return a("{base_url}/inventory/categories/:id.json",{id:"@id",display_type:"full"},{getItems:{url:"{base_url}/inventory/items/:id.json",method:"GET",params:{id:"@id"}},getItem:{url:"{base_url}/inventory/categories/:categoryId/items/:id.json",method:"GET",params:{id:"@id",categoryId:"@categoryId"}},deleteItem:{url:"{base_url}/inventory/categories/:categoryId/items/:id.json",method:"DELETE",params:{id:"@id",categoryId:"@categoryId"}}})}]),angular.module("zupPainelApp"),angular.module("zupPainelApp").directive("mapItemsSimple",function(){return{restrict:"A",link:function(a,b){var c=[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],d=new google.maps.StyledMapType(c,{name:"zup"}),e=new google.maps.LatLng(-23.549671,-46.6321713),f={center:e,zoom:17,disableDefaultUI:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}},g=new google.maps.Map(b[0],f);g.mapTypes.set("zup",d),g.setMapTypeId("zup");for(var h=[[],[],[],[],[]],i=["images/4fd8c824.map_pin_boca-lobo.png","images/3bb7468f.map_pin_entulho.png","images/0ee61379.ponto_bocalobo.png","images/98cfce97.ponto_floresta-urbana.png","images/455bb34c.ponto_praca-wifi.png"],j=[[[-23.549671,-46.6321713]],[[-23.549297,-46.633701]],[[-23.552349,-46.632923],[-23.551926,-46.632601],[-23.55113,-46.632376],[-23.549861,-46.632065],[-23.54931,-46.632043],[-23.548307,-46.632494]],[[-23.549822,-46.631056],[-23.549654,-46.630638],[-23.550087,-46.630852],[-23.549969,-46.630509],[-23.549841,-46.630273],[-23.54929,-46.629908],[-23.549576,-46.629544]],[[-23.550878,-46.631134]]],k=[[['<h1>Coleta de entulho</h1><p>Enviada ontem</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada hoje</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada hoje</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 3 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 5 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 4 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 6 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 2 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada hoje</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada ontem</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 2 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 3 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 4 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 5 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada há 1 semana</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']]],l=j[0].length-1;l>=0;l--){var m=new google.maps.LatLng(j[0][l][0],j[0][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[0],animation:google.maps.Animation.DROP});h[0].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){console.log(p),o.setContent('<div class="pinTooltip">'+k[0][p]+"</div>"),o.open(g,this)})}for(var l=j[1].length-1;l>=0;l--){var m=new google.maps.LatLng(j[1][l][0],j[1][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[1],animation:google.maps.Animation.DROP});h[1].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[1][p]+"</div>"),o.open(g,this)})}for(var l=j[2].length-1;l>=0;l--){var m=new google.maps.LatLng(j[2][l][0],j[2][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[2],animation:google.maps.Animation.DROP});h[2].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[2][p]+"</div>"),o.open(g,this)})}for(var l=j[3].length-1;l>=0;l--){var m=new google.maps.LatLng(j[3][l][0],j[3][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[3],animation:google.maps.Animation.DROP});h[3].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[3][p]+"</div>"),o.open(g,this)})}for(var l=j[4].length-1;l>=0;l--){var m=new google.maps.LatLng(j[4][l][0],j[4][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[4],animation:google.maps.Animation.DROP});h[4].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[4][p]+"</div>"),o.open(g,this)})}}}}),angular.module("zupPainelApp").directive("mapShowItem",["$timeout","$q","$rootScope","Inventories","$compile",function(a,b,c,d,e){return{restrict:"A",link:function(a,b){var c={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},map:null,start:function(){var d=new google.maps.StyledMapType(this.options.styles,{name:"zup"});
this.map=new google.maps.Map(b[0],this.options.map),this.map.mapTypes.set("zup",d),this.map.setMapTypeId("zup"),a.$watch("loading",function(){"undefined"!=typeof a.item&&setTimeout(function(){google.maps.event.trigger(c.map,"resize"),google.maps.event.trigger(c.map,"bounds_changed"),c.map.setCenter(c.options.homeLatlng),c.addMarker(a.item,a.category)},80)})},addMarker:function(b,d){var f=new google.maps.LatLng(b.position.latitude,b.position.longitude),g=c.infoWindow,d=d,h=new google.maps.Size(15,15),i=new google.maps.MarkerImage(d.pin.retina.web,null,null,null,h),j={position:f,map:this.map,icon:i,category:d,item:b},k=new google.maps.Marker(j);this.map.setCenter(f),google.maps.event.addListener(k,"click",function(){var b="<div class=\"pinTooltip\"><h1>{{category.title}}</h1><p>Enviada {{ item.created_at | date: 'dd/MM/yy HH:mm'}}</p></div>",d=a.$new(!0);d.category=this.category,d.item=this.item;var f=e(b)(d);d.$apply(),g.setContent(f[0]),g.open(c.map,this)})}};c.start()}}}]),angular.module("zupPainelApp").directive("genericInput",function(){return{restrict:"A",link:function(a,b){a.$watch("inputErrors",function(){var c=a.inputErrors,d=$(b).parent(".form-group");if(b.removeClass("has-error"),d.removeClass("has-error"),"undefined"!=typeof c)for(var e in c)e===b.attr("name")&&(b.addClass("has-error"),d.addClass("has-error"))}),a.$parent.$watch("processingForm",function(){a.$parent.processingForm===!0?b.attr("disabled",!0):b.attr("disabled",!1)})}}}),angular.module("zupPainelApp").filter("formatErrors",["$sce",function(a){return function(b){var c=[];for(var d in b)for(var e=0;e<b[d].length;e++){var f=d.charAt(0).toUpperCase()+d.slice(1);c.push(f+" "+b[d][e])}return a.trustAsHtml(c.join("<br>"))}}]),angular.module("zupPainelApp").directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]);