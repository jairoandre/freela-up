"use strict";angular.module("zupPainelApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","ui.mask","ui.select2","restangular","infinite-scroll","colorpicker.module","frapontillo.bootstrap-switch","angularFileUpload","ui.autocomplete","ngAnimate"]).config(["$routeProvider","$httpProvider","RestangularProvider",function(a,b,c){a.when("/",{templateUrl:"views/login.html",controller:"MainCtrl"}).when("/groups",{templateUrl:"views/groups/index.html",controller:"GroupsCtrl",access:{logged:!0}}).when("/groups/add",{templateUrl:"views/groups/add.html",controller:"GroupsCtrl",access:{logged:!0}}).when("/groups/:id",{templateUrl:"views/groups/list.html",controller:"ViewGroupsCtrl",access:{logged:!0}}).when("/users",{templateUrl:"views/users/index.html",controller:"UsersCtrl",access:{logged:!0}}).when("/users/group/:groupId",{templateUrl:"views/users/index.html",controller:"UsersCtrl",access:{logged:!0}}).when("/users/add",{templateUrl:"views/users/edit.html",controller:"UsersEditCtrl",access:{logged:!0}}).when("/users/:id",{templateUrl:"views/users/view.html",controller:"UsersViewCtrl",access:{logged:!0}}).when("/users/edit/:id",{templateUrl:"views/users/edit.html",controller:"UsersEditCtrl",access:{logged:!0}}).when("/reports",{templateUrl:"views/reports/index.html",controller:"ReportsCtrl",resolve:{isMap:function(){return!1}},access:{logged:!0}}).when("/reports/map",{templateUrl:"views/reports/map.html",controller:"ReportsCtrl",resolve:{isMap:function(){return!0}},access:{logged:!0}}).when("/reports/categories",{templateUrl:"views/reports/categories.html",controller:"ReportsCategoriesCtrl",access:{logged:!0}}).when("/reports/categories/new",{templateUrl:"views/reports/editCategory.html",controller:"ReportsCategoriesEditCtrl",access:{logged:!0}}).when("/reports/categories/:id/edit",{templateUrl:"views/reports/editCategory.html",controller:"ReportsCategoriesEditCtrl",access:{logged:!0}}).when("/reports/categories/:categoryId/item/:id",{templateUrl:"views/reports/view.html",controller:"ReportsCategoriesItemCtrl",access:{logged:!0}}).when("/inventories",{templateUrl:"views/inventories/index.html",controller:"InventoriesCtrl",resolve:{isMap:function(){return!1}},access:{logged:!0}}).when("/inventories/map",{templateUrl:"views/inventories/map.html",controller:"InventoriesCtrl",resolve:{isMap:function(){return!0}},access:{logged:!0}}).when("/inventories/categories",{templateUrl:"views/inventories/categories.html",controller:"InventoriesCategoriesCtrl",access:{logged:!0}}).when("/inventories/categories/add",{templateUrl:"views/inventories/edit.html",controller:"InventoriesCategoriesEditCtrl",access:{logged:!0}}).when("/inventories/categories/:categoryId/edit",{templateUrl:"views/inventories/edit.html",controller:"InventoriesCategoriesEditCtrl",access:{logged:!0}}).when("/inventories/categories/select",{templateUrl:"views/inventories/select.html",controller:"InventoriesCategoriesSelectCtrl",access:{logged:!0}}).when("/inventories/categories/:categoryId/item/add",{templateUrl:"views/inventories/items/edit.html",controller:"InventoriesCategoriesItemEditCtrl",access:{logged:!0}}).when("/inventories/categories/:categoryId/item/:id/edit",{templateUrl:"views/inventories/items/edit.html",controller:"InventoriesCategoriesItemEditCtrl",access:{logged:!0}}).when("/inventories/categories/:categoryId/item/:id",{templateUrl:"views/inventories/items/view.html",controller:"InventoriesCategoriesItemCtrl",access:{logged:!0}}).when("/tags",{templateUrl:"views/tags/index.html",controller:"TagsCtrl",access:{logged:!0}}).when("/flows",{templateUrl:"views/flows/index.html",controller:"FlowsCtrl",access:{logged:!0}}).when("/flows/steps",{templateUrl:"views/flows/steps.html",access:{logged:!0}}).when("/flows/permissions",{templateUrl:"views/flows/permissions.html",access:{logged:!0}}).when("/flows/permissions/edit",{templateUrl:"views/flows/editPermissions.html",access:{logged:!0}}).when("/flows/forms/edit",{templateUrl:"views/flows/editForm.html",access:{logged:!0}}).when("/flows/triggers/edit",{templateUrl:"views/flows/editTriggers.html",access:{logged:!0}}).when("/flows/versions",{templateUrl:"views/flows/versions.html",access:{logged:!0}}).when("/cases",{templateUrl:"views/cases/index.html",access:{logged:!0}}).when("/cases/new",{templateUrl:"views/cases/new.html",access:{logged:!0}}).when("/cases/finished",{templateUrl:"views/cases/finished.html",access:{logged:!0}}).otherwise({redirectTo:"/"}),b.interceptors.push(["$q","$injector",function(a,b){return{request:function(c){c.url=c.url.replace("{base_url}","http://staging.zup.sapience.io");var d=null;return b.invoke(["Auth",function(a){d=a.getToken()}]),c.headers["X-App-Token"]=d,c||a.when(c)},responseError:function(c){var d=[400];return("undefined"==typeof d||-1===d.indexOf(c.status))&&b.invoke(["Error",function(a){a.showDetails(c)}]),a.reject(c)}}}]),b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"],c.setBaseUrl("http://staging.zup.sapience.io"),c.setFullResponse(!0),c.setResponseExtractor(function(a,b,c){if("undefined"!=typeof a[c])return a[c];for(var d in a)return a[d];return a}),c.setRequestInterceptor(function(a,b){return"remove"===b?null:a})}]).run(["$rootScope","$location","Auth","$timeout",function(a,b,c,d){a.$on("$routeChangeStart",function(d,e,f){if("undefined"==typeof f&&(a.isLoading=!0),"undefined"!=typeof e.access&&e.access.logged===!0){var g=c.check();g.then(function(){a.isLoading=!1},function(){a.isLoading=!1,b.path("/")})}else a.isLoading=!1}),a.showMessage=function(b,c,e,f){a.systemMessage={icon:b,text:c,messageClass:e},a.showSystemMessage=!0,d(function(){a.showSystemMessage=!1},3500),f===!0&&(a.scrollTop=!0)}}]),angular.module("zupPainelApp").controller("MainCtrl",["User","Error","$scope","$location","Auth",function(a,b,c,d,e){var f=e.getToken();null!==f&&d.path("/reports"),c.login=function(){c.loginError=!1;var b=new a(c.email,c.password);b.auth().then(function(){d.path("/reports")},function(a){(400===a.status||401===a.status)&&(c.loginError=!0)})}}]),angular.module("zupPainelApp").controller("GroupsCtrl",["$scope","$modal","Restangular",function(a,b,c){a.loading=!0;var d=c.all("groups").getList();d.then(function(b){a.groups=b.data,a.loading=!1}),a.deleteGroup=function(c){b.open({templateUrl:"removeGroup.html",windowClass:"removeModal",resolve:{groupsList:function(){return a.groups}},controller:["$scope","$modalInstance",function(a,b){a.group=c,a.close=function(){b.close()}}]})}}]).controller("ViewGroupsCtrl",["$scope","Restangular","$routeParams","$q",function(a,b,c,d){var e=c.id;a.loading=!0,a.sort={column:"",descending:!1},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending};var f=b.one("groups",e).get(),g=b.one("groups",e).one("users").getList();d.all([f,g]).then(function(b){a.group=b[0].data,a.users=b[1].data,a.loading=!1})}]),angular.module("zupPainelApp").controller("UsersCtrl",["$scope","$q","$routeParams","$modal","Restangular",function(a,b,c,d,e){a.loading=!0,a.loadingPagination=!1,a.sort={column:"",descending:!1},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending};var f,g=c.groupId,h=1,i=30,j="",k=function(b,c){return"undefined"!=typeof b?(a.groupId=b,""!==c?e.one("search").one("groups",b).all("users").getList({name:c,email:c,page:h,per_page:i}):e.one("groups",b).all("users").getList({page:h,per_page:i})):(b=a.groupId=null,""!==c?e.one("search").all("users").getList({name:c,email:c,page:h,per_page:i}):e.all("users").getList({page:h,per_page:i}))},l=e.all("groups").getList(),m=a.getData=function(c){if(a.loadingPagination===!1){a.loadingPagination=!0;var d=k(g,j);return b.all([d,l]).then(function(b){if(a.groups=b[1].data,c!==!0)a.users=b[0].data;else{"undefined"==typeof a.users&&(a.users=[]);for(var d=0;d<b[0].data.length;d++)a.users.push(b[0].data[d]);h++}f=parseInt(b[0].headers().total);var e=Math.ceil(f/i);a.loadingPagination=h===e+1?null:!1,a.loading=!1}),d}};a.search=function(b){j=b,h=1,a.loadingPagination=!1,a.loadingContent=!0,m().then(function(){a.loadingContent=!1,h++})},a.deleteUser=function(b){d.open({templateUrl:"views/users/removeUser.html",windowClass:"removeModal",resolve:{usersList:function(){return a.users}},controller:["$scope","$modalInstance","Users","usersList",function(a,c,d,e){a.user=b,a.confirm=function(){var b=d.get({id:a.user.id},function(){b.$delete({id:a.user.id},function(){c.close(),e.splice(e.indexOf(a.user),1)})})},a.close=function(){c.close()}}]})}}]).controller("UsersViewCtrl",["$scope","Restangular","$routeParams","$modal","$location",function(a,b,c,d,e){a.loading=!0,b.one("users",c.id).get().then(function(b){a.user=b.data,a.loading=!1}),a.deleteUser=function(a){d.open({templateUrl:"views/users/removeUser.html",windowClass:"removeModal",controller:["$scope","$modalInstance","Users",function(b,c,d){b.user=a,b.confirm=function(){var a=d.get({id:b.user.id},function(){a.$delete({id:b.user.id},function(){c.close(),e.path("/users")})})},b.close=function(){c.close()}}]})}}]).controller("UsersEditCtrl",["$scope","Restangular","$routeParams","$location",function(a,b,c,d){var e=a.updating=!1,f=c.id;"undefined"!=typeof f&&(e=!0,a.updating=!0),a.loading=!0,e?b.one("users",c.id).get().then(function(b){a.user=b.data,a.loading=!1}):(a.loading=!1,a.user={}),a.send=function(){if(a.inputErrors=null,a.processingForm=!0,e){var c=b.one("users",f).customPUT(a.user);c.then(function(){a.showMessage("ok","O usuário foi atualizado com sucesso","success",!0),a.processingForm=!1},function(b){a.showMessage("exclamation-sign","O usuário não pode ser salvo","error",!0),a.inputErrors=b.data.error,a.processingForm=!1})}else{var g=b.one("users").post(null,a.user);g.then(function(){a.showMessage("ok","O usuário foi criado com sucesso","success",!0),d.path("/users"),a.processingForm=!1},function(b){a.showMessage("exclamation-sign","O usuário não pode ser criado","error",!0),a.inputErrors=b.data.error,a.processingForm=!1})}}}]),angular.module("zupPainelApp").controller("ReportsCtrl",["$scope","Restangular","$modal","$q","isMap",function(a,b,c,d,e){a.loading=!0;var f,g=1,h=30;a.loadingPagination=!1;var i=function(){a.selectedCategories=[],a.selectedStatuses=[],a.selectedUsers=[],a.beginDate=null,a.endDate=null,a.searchText=null,a.position=null,a.zoom=null};a.sort={column:"",descending:!1},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending},a.$watchCollection("[advancedSearch, activeAdvancedFilters]",function(){i()}),a.availableFilters=[{name:"Com as categorias...",action:"category"},{name:"Com os estados...",action:"status"},{name:"Criado pelos munícipes...",action:"author"},{name:"Por período...",action:"date"},{name:"Por perímetro...",action:"area"}],a.activeAdvancedFilters=[];var j=function(){var c=b.one("search").all("reports").all("items"),d={page:g,per_page:h};if(null!==a.searchText&&(d.query=a.searchText),0!==a.selectedCategories.length&&(d.reports_categories_ids=a.selectedCategories.join()),0!==a.selectedStatuses.length&&(d.statuses_ids=a.selectedStatuses.join()),0!==a.selectedUsers.length&&(d.users_ids=a.selectedUsers.join()),null!==a.beginDate){var e=new Date(a.beginDate);d.begin_date=e.toISOString()}if(null!==a.endDate){var f=new Date(a.endDate);d.end_date=f.toISOString()}return null!==a.position&&(d["position[latitude]"]=a.position.latitude,d["position[longitude]"]=a.position.longitude,d["position[distance]"]=a.position.distance),null!==a.zoom&&(d.zoom=a.zoom),c.getList(d)},k=b.one("reports").all("categories").getList({display_type:"full"}),l=a.getData=function(b,c){if(a.loadingPagination===!1){a.loadingPagination=!0,"undefined"!=typeof c&&(a.position=c.position,a.zoom=c.zoom);var e=j();return d.all([e,k]).then(function(c){if(a.categories=c[1].data,b!==!0)a.reports=c[0].data;else{"undefined"==typeof a.reports&&(a.reports=[]);for(var d=0;d<c[0].data.length;d++)a.reports.push(c[0].data[d]);g++}f=parseInt(c[0].headers().total);var e=Math.ceil(f/h);a.loadingPagination=g===e+1?null:!1,a.loading=!1}),e}};k.then(function(b){a.statuses=[];for(var c=b.data.length-1;c>=0;c--)for(var d=b.data[c].statuses.length-1;d>=0;d--){for(var e=!1,f=a.statuses.length-1;f>=0;f--)a.statuses[f].id===b.data[c].statuses[d].id&&(e=!0);e||a.statuses.push(b.data[c].statuses[d])}});var m=a.reload=function(){e?a.$broadcast("updateMap",!0):(g=1,a.loadingPagination=!1,a.loadingContent=!0,a.reports=[],l().then(function(){a.loadingContent=!1,g++}))};a.$watchCollection("[selectedCategories, selectedStatuses, beginDate, endDate]",function(){m()}),a.$watch("advancedSearch",function(){a.advancedSearch===!0&&m()}),a.$watch("activeAdvancedFilters",function(){if(a.advancedSearch===!0){i();for(var b=a.activeAdvancedFilters.length-1;b>=0;b--){var c=a.activeAdvancedFilters[b];"query"===c.type&&(a.searchText=c.value),"categories"===c.type&&(a.selectedCategories=c.value),"statuses"===c.type&&(a.selectedStatuses=c.value),"authors"===c.type&&(a.selectedUsers=c.value)}m()}},!0),a.removeFilter=function(b){a.activeAdvancedFilters.splice(a.activeAdvancedFilters.indexOf(b),1)},a.resetFilters=function(){a.activeAdvancedFilters=[]};var n=function(b){var c={title:"Título ou endereço",desc:b,type:"query",value:b};a.activeAdvancedFilters.push(c)},o=function(){c.open({templateUrl:"views/reports/filters/category.html",windowClass:"filterCategoriesModal",resolve:{categories:function(){return a.categories},activeAdvancedFilters:function(){return a.activeAdvancedFilters}},controller:["$scope","$modalInstance","categories","activeAdvancedFilters",function(a,b,c,d){a.categories=c,a.activeAdvancedFilters=d,a.updateCategory=function(b){var c=a.categories.indexOf(b);a.categories[c].selected=a.categories[c].selected===!0?!1:!0},a.save=function(){for(var c={title:"Categorias",type:"categories",value:[]},d=[],e=a.categories.length-1;e>=0;e--)a.categories[e].selected===!0&&(c.value.push(a.categories[e].id),d.push(" "+a.categories[e].title));c.desc=d.join(),a.activeAdvancedFilters.push(c),b.close()},a.close=function(){b.close()}}]})},p=function(){c.open({templateUrl:"views/reports/filters/status.html",windowClass:"filterStatusesModal",resolve:{statuses:function(){return a.statuses},activeAdvancedFilters:function(){return a.activeAdvancedFilters}},controller:["$scope","$modalInstance","statuses","activeAdvancedFilters",function(a,b,c,d){a.statuses=c,a.activeAdvancedFilters=d,a.updateStatus=function(b){var c=a.statuses.indexOf(b);a.statuses[c].selected=a.statuses[c].selected===!0?!1:!0},a.save=function(){for(var c={title:"Estados",type:"statuses",value:[]},d=[],e=a.statuses.length-1;e>=0;e--)a.statuses[e].selected===!0&&(c.value.push(a.statuses[e].id),d.push(" "+a.statuses[e].title));c.desc=d.join(),a.activeAdvancedFilters.push(c),b.close()},a.close=function(){b.close()}}]})},q=function(){c.open({templateUrl:"views/reports/filters/author.html",windowClass:"filterAuthorModal",resolve:{activeAdvancedFilters:function(){return a.activeAdvancedFilters}},controller:["$scope","$modalInstance","activeAdvancedFilters",function(a,c,d){a.activeAdvancedFilters=d,a.users=[],a.field={},a.usersAutocomplete={options:{onlySelect:!0,source:function(a,c){var d=b.one("search").all("users").getList({name:a.term});d.then(function(a){c($.map(a.data,function(a){return{label:a.name,value:a.name,user:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:function(){}}}},a.usersAutocomplete.events={select:function(b,c){for(var d=!1,e=a.users.length-1;e>=0;e--)a.users[e].id===c.item.user.id&&(d=!0);d||a.users.push(c.item.user)},change:function(){a.field.text=""}},a.removeUser=function(b){a.users.splice(a.users.indexOf(b),1)},a.save=function(){for(var b={title:"Usuários",type:"authors",value:[]},d=[],e=a.users.length-1;e>=0;e--)b.value.push(a.users[e].id),d.push(" "+a.users[e].name);b.desc=d.join(),a.activeAdvancedFilters.push(b),c.close()},a.close=function(){c.close()}}]})};a.loadFilter=function(b){"query"===b&&n(a.filterQuery),"category"===b&&o(),"status"===b&&p(),"author"===b&&q()},a.search=function(b){a.searchText=b,m()},a.getReportCategory=function(b){for(var c=a.categories.length-1;c>=0;c--)if(a.categories[c].id===b)return a.categories[c];return null},a.deleteReport=function(d){c.open({templateUrl:"views/reports/removeReport.html",windowClass:"removeModal",resolve:{reportsList:function(){return a.reports},report:function(){return d}},controller:["$scope","$modalInstance","reportsList","report",function(a,c,d,e){a.report=e,a.confirm=function(){var e=b.one("reports").one("items",a.report.id).remove();e.then(function(){c.close(),a.showMessage("ok","O Relato "+a.report.protocol+" foi removido com sucesso","success",!0),d.splice(d.indexOf(a.report),1)})},a.close=function(){c.close()}}]})},a.editReportStatus=function(a,d){c.open({templateUrl:"views/reports/editReportStatus.html",windowClass:"editStatusModal",resolve:{report:function(){return a},category:function(){return d}},controller:["$scope","$modalInstance","category","report",function(a,c,d,e){a.category=d,a.report=e,a.changeStatus=function(b){a.report.status_id=b},a.save=function(){var d=b.one("reports",a.category.id).one("items",a.report.id).customPUT({status_id:a.report.status_id});d.then(function(){c.close()})},a.close=function(){c.close()}}]})}}]).controller("ReportsCategoriesCtrl",["$scope","Restangular","$modal",function(a,b,c){a.loading=!0;var d=b.one("reports").all("categories").getList();d.then(function(b){a.categories=b.data,a.loading=!1}),a.deleteCategory=function(d){c.open({templateUrl:"views/reports/removeCategory.html",windowClass:"removeModal",resolve:{reportsCategoriesList:function(){return a.categories}},controller:["$scope","$modalInstance","reportsCategoriesList",function(a,c,e){a.category=d,a.confirm=function(){var d=b.one("reports").one("categories",a.category.id).remove();d.then(function(){c.close(),a.showMessage("ok","A categoria de relato foi removida com sucesso","success",!0),e.splice(e.indexOf(a.category),1)})},a.close=function(){c.close()}}]})}}]).controller("ReportsCategoriesItemCtrl",["$scope","Restangular","$routeParams","$q","$modal",function(a,b,c,d,e){a.loading=!0;var f=b.one("reports").one("items",c.id).get(),g=b.one("reports",c.id).one("feedback").get(),h=b.one("reports").all("categories").getList();d.all([f,h,g]).then(function(b){a.report=b[0].data,a.report.status_id=a.report.status.id,a.feedback=b[2].data;for(var d=b[1].data.length-1;d>=0;d--)b[1].data[d].id.toString()===c.categoryId&&(a.category=b[1].data[d]);a.images=[];for(var e=a.report.images.length-1;e>=0;e--)a.images.push({src:a.report.images[e].high});a.loading=!1}),a.editReportStatus=function(a,c){e.open({templateUrl:"views/reports/editReportStatus.html",windowClass:"editStatusModal",resolve:{report:function(){return a},category:function(){return c}},controller:["$scope","$modalInstance","category","report",function(a,c,d,e){a.category=d,a.report=angular.copy(e),a.changeStatus=function(b){a.report.status_id=b},a.save=function(){var d=b.one("reports",a.category.id).one("items",a.report.id).customPUT({status_id:a.report.status_id});d.then(function(){e.status_id=a.report.status_id,c.close()})},a.close=function(){c.close()}}]})}}]).controller("ReportsCategoriesEditCtrl",["$scope","$routeParams","Restangular","$fileUploader","$q","$location","$modal",function(a,b,c,d,e,f,g){var h=a.updating=!1,i=b.id;"undefined"!=typeof i&&(h=!0,a.updating=!0),a.loading=!0,a.defaultResolutionTimeSelection=60,a.defaultUserResponseTimeSelection=60;var j,k=c.one("inventory").all("categories").getList();if(h){j=a.category={};var l=c.one("reports").one("categories",i).get();e.all([k,l]).then(function(b){if(a.categories=b[0].data,j.title=b[1].data.title,j.color=b[1].data.color,j.allows_arbitrary_position=b[1].data.allows_arbitrary_position,j.statuses=b[1].data.statuses,null!==b[1].data.user_response_time&&(a.enabledUserResponseTime=!0,j.user_response_time=Math.round(b[1].data.user_response_time/60)),null!==b[1].data.resolution_time&&(j.resolution_time=Math.round(b[1].data.resolution_time/60)),j.inventory_categories=[],"object"==typeof b[1].data.inventory_categories&&0!==b[1].data.inventory_categories.length)for(var c=b[1].data.inventory_categories.length-1;c>=0;c--)j.inventory_categories.push(b[1].data.inventory_categories[c].id);a.icon=b[1].data.original_icon,a.loading=!1})}else k.then(function(b){a.categories=b.data,a.loading=!1}),a.enabledUserResponseTime=!1,j=a.category={marker:"R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",inventory_categories:[],allows_arbitrary_position:!0,color:"#2AB4DC",statuses:[{title:"Em aberto",color:"#E68012",initial:!0,"final":!1,active:!0},{title:"Em andamento",color:"#919191",initial:!1,"final":!1,active:!0},{title:"Resolvido",color:"#5EB623",initial:!1,"final":!0,active:!0}]};a.categoriesAutocomplete={options:{source:function(a,b){var d=c.one("search").one("inventory").all("categories").getList({title:a.term});d.then(function(a){b($.map(a.data,function(a){return{label:a.title,value:a.title,id:a.id}}))})},select:function(b,c){a.addCategory(c.item.id)},messages:{noResults:"",results:function(){}}}},a.addCategory=function(a){~j.inventory_categories.indexOf(a)||j.inventory_categories.push(a)},a.removeCategory=function(a){j.inventory_categories.splice(j.inventory_categories.indexOf(a),1)},a.manageStatuses=function(){g.open({templateUrl:"views/reports/manageStatuses.html",windowClass:"manageStatuses",resolve:{category:function(){return a.category}},controller:["$scope","$modalInstance","category",function(a,b,c){a.category=c,a.newStatus={},a.createStatus=function(){""!==a.newStatus.title&&(a.category.statuses.push({title:a.newStatus.title,color:"#FFFFFF",initial:"false","final":"false"}),a.newStatus.title="")},a.changeInitial=function(b){for(var c=a.category.statuses.length-1;c>=0;c--)b!==a.category.statuses[c]&&(a.category.statuses[c].initial=!1);b.initial=!0},a.removeStatus=function(b){a.category.statuses.splice(a.category.statuses.indexOf(b),1)},a.close=function(){b.close()}}]})};var m=a.uploader=d.create({scope:a,filters:[function(){return m.queue=[],!0}]});m.filters.push(function(a){var b=m.isHTML5?a.type:"/"+a.value.slice(a.value.lastIndexOf(".")+1);return b="|"+b.toLowerCase().slice(b.lastIndexOf("/")+1)+"|",-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}),a.send=function(){function b(a){var b=e.defer(),c=new FileReader;return c.addEventListener("load",function(a){var c=a.target;d=c.result.replace(/^data:image\/[^;]+;base64,/,""),b.resolve()}),c.readAsDataURL(a),b.promise}a.inputErrors=null,a.processingForm=!0;for(var d,g=[],k=m.queue.length-1;k>=0;k--)g.push(b(m.queue[k].file));e.all(g).then(function(){var b=angular.copy(j),e=b.statuses;b.statuses={};for(var g=e.length-1;g>=0;g--)e[g].initial=e[g].initial.toString(),e[g].final=e[g].initial.toString(),e[g].active=e[g].active.toString(),b.statuses[g]=e[g];if(b.resolution_time=Math.round(b.resolution_time*a.defaultResolutionTimeSelection),b.user_response_time="undefined"!=typeof b.user_response_time&&"null"!==b.user_response_time&&1==a.enabledUserResponseTime?Math.round(b.user_response_time*a.defaultUserResponseTimeSelection):null,h){d&&(b.icon=d);var k=c.one("reports").one("categories",i).customPUT(b);k.then(function(){a.showMessage("ok","A categoria de relato foi atualizada com sucesso","success",!0),a.processingForm=!1},function(b){a.showMessage("exclamation-sign","A categoria de relato não pode ser salva","error",!0),a.inputErrors=b.data.error,a.processingForm=!1})}else{b.icon=d,b.marker=d;var l=c.one("reports").post("categories",b);l.then(function(){f.path("/reports/categories"),a.processingForm=!1},function(b){a.showMessage("exclamation-sign","A categoria de relato não pode ser salva","error",!0),a.inputErrors=b.data.error,a.processingForm=!1})}})}}]),angular.module("zupPainelApp").controller("InventoriesCtrl",["$scope","$modal","Inventories","$q","Restangular","isMap",function(a,b,c,d,e,f){a.loading=!0;var g,h=1,i=30,j="";a.loadingPagination=!1;var k=function(){a.selectedCategories=[],a.selectedStatuses=[],a.selectedUsers=[],a.beginDate=null,a.endDate=null,a.searchText=null,a.fields=null,a.position=null,a.zoom=null};a.sort={column:"",descending:!1},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending},a.$watchCollection("[advancedSearch, activeAdvancedFilters]",function(){k()}),a.availableFilters=[{name:"Com as categorias...",action:"category"},{name:"Com os estados...",action:"status"},{name:"Criado pelos munícipes...",action:"author"},{name:"Por período...",action:"date"},{name:"Por campos...",action:"fields"}],a.activeAdvancedFilters=[];var l=function(){var b=e.one("search").all("inventory").all("items"),c={page:h,per_page:i};if(null!==a.searchText&&(c.query=a.searchText),0!==a.selectedCategories.length&&(c.inventory_categories_ids=a.selectedCategories.join()),0!==a.selectedStatuses.length&&(c.inventory_statuses_ids=a.selectedStatuses.join()),0!==a.selectedUsers.length&&(c.users_ids=a.selectedUsers.join()),null!==a.beginDate){var d=new Date(a.beginDate);c["created_at[begin]"]=d.toISOString()}if(null!==a.endDate){var f=new Date(a.endDate);c["created_at[end]"]=f.toISOString()}if(null!==a.fields)for(var g=a.fields.length-1;g>=0;g--){var j="fields["+a.fields[g].id+"]["+a.fields[g].condition+"]";c[j]=a.fields[g].value}return null!==a.position&&(c["position[latitude]"]=a.position.latitude,c["position[longitude]"]=a.position.longitude,c["position[distance]"]=a.position.distance),null!==a.zoom&&(c.zoom=a.zoom),b.getList(c)},m=e.one("inventory").all("categories").getList(),n=a.getData=function(b){if(a.loadingPagination===!1){a.loadingPagination=!0;var c=l(j);return d.all([c,m]).then(function(c){if(a.categories=c[1].data,b!==!0)a.items=c[0].data;else{"undefined"==typeof a.items&&(a.items=[]);for(var d=0;d<c[0].data.length;d++)a.items.push(c[0].data[d]);h++}g=parseInt(c[0].headers().total);var e=Math.ceil(g/i);a.loadingPagination=h===e+1?null:!1,a.loading=!1}),c}};m.then(function(b){a.statuses=[];for(var c=b.data.length-1;c>=0;c--)for(var d=b.data[c].statuses.length-1;d>=0;d--){for(var e=!1,f=a.statuses.length-1;f>=0;f--)a.statuses[f].id===b.data[c].statuses[d].id&&(e=!0);e||a.statuses.push(b.data[c].statuses[d])}});var o=a.reload=function(){f?a.$broadcast("updateMap",!0):(h=1,a.loadingPagination=!1,a.loadingContent=!0,a.items=[],n().then(function(){a.loadingContent=!1,h++}))};a.$watchCollection("[selectedCategories, selectedStatuses, beginDate, endDate]",function(){o()}),a.$watch("advancedSearch",function(){a.advancedSearch===!0&&o()}),a.$watch("activeAdvancedFilters",function(){if(a.advancedSearch===!0){k();for(var b=a.activeAdvancedFilters.length-1;b>=0;b--){var c=a.activeAdvancedFilters[b];"query"===c.type&&(a.searchText=c.value),"categories"===c.type&&(a.selectedCategories=c.value),"statuses"===c.type&&(a.selectedStatuses=c.value),"authors"===c.type&&(a.selectedUsers=c.value),"fields"===c.type&&(a.fields=c.value)}o()}},!0),a.removeFilter=function(b){a.activeAdvancedFilters.splice(a.activeAdvancedFilters.indexOf(b),1)},a.resetFilters=function(){a.activeAdvancedFilters=[]};var p=function(b){var c={title:"Título ou endereço",desc:b,type:"query",value:b};a.activeAdvancedFilters.push(c)},q=function(){b.open({templateUrl:"views/inventories/filters/category.html",windowClass:"filterCategoriesModal",resolve:{categories:function(){return a.categories},activeAdvancedFilters:function(){return a.activeAdvancedFilters}},controller:["$scope","$modalInstance","categories","activeAdvancedFilters",function(a,b,c,d){a.categories=c,a.activeAdvancedFilters=d,a.updateCategory=function(b){var c=a.categories.indexOf(b);a.categories[c].selected=a.categories[c].selected===!0?!1:!0},a.save=function(){for(var c={title:"Categorias",type:"categories",value:[]},d=[],e=a.categories.length-1;e>=0;e--)a.categories[e].selected===!0&&(c.value.push(a.categories[e].id),d.push(" "+a.categories[e].title));c.desc=d.join(),a.activeAdvancedFilters.push(c),b.close()},a.close=function(){b.close()}}]})},r=function(){b.open({templateUrl:"views/inventories/filters/status.html",windowClass:"filterStatusesModal",resolve:{statuses:function(){return a.statuses},activeAdvancedFilters:function(){return a.activeAdvancedFilters}},controller:["$scope","$modalInstance","statuses","activeAdvancedFilters",function(a,b,c,d){a.statuses=c,a.activeAdvancedFilters=d,a.updateStatus=function(b){var c=a.statuses.indexOf(b);a.statuses[c].selected=a.statuses[c].selected===!0?!1:!0},a.save=function(){for(var c={title:"Estados",type:"statuses",value:[]},d=[],e=a.statuses.length-1;e>=0;e--)a.statuses[e].selected===!0&&(c.value.push(a.statuses[e].id),d.push(" "+a.statuses[e].title));c.desc=d.join(),a.activeAdvancedFilters.push(c),b.close()},a.close=function(){b.close()}}]})},s=function(){b.open({templateUrl:"views/inventories/filters/author.html",windowClass:"filterAuthorModal",resolve:{activeAdvancedFilters:function(){return a.activeAdvancedFilters}},controller:["$scope","$modalInstance","activeAdvancedFilters",function(a,b,c){a.activeAdvancedFilters=c,a.users=[],a.field={},a.usersAutocomplete={options:{onlySelect:!0,source:function(a,b){var c=e.one("search").all("users").getList({name:a.term});c.then(function(a){b($.map(a.data,function(a){return{label:a.name,value:a.name,user:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:function(){}}}},a.usersAutocomplete.events={select:function(b,c){for(var d=!1,e=a.users.length-1;e>=0;e--)a.users[e].id===c.item.user.id&&(d=!0);d||a.users.push(c.item.user)},change:function(){a.field.text=""}},a.removeUser=function(b){a.users.splice(a.users.indexOf(b),1)},a.save=function(){for(var c={title:"Usuários",type:"authors",value:[]},d=[],e=a.users.length-1;e>=0;e--)c.value.push(a.users[e].id),d.push(" "+a.users[e].name);c.desc=d.join(),a.activeAdvancedFilters.push(c),b.close()},a.close=function(){b.close()}}]})},t=function(){b.open({templateUrl:"views/inventories/filters/fields.html",windowClass:"fieldsCategoriesModal",resolve:{categories:function(){return a.categories},activeAdvancedFilters:function(){return a.activeAdvancedFilters}},controller:["$scope","$modalInstance","categories","activeAdvancedFilters",function(a,b,c,d){a.categories=c,a.activeAdvancedFilters=d,a.items=[],a.methods=[{condition:"greater_than",text:"Maior que"},{condition:"lesser_than",text:"Menor"},{condition:"equal_to",text:"Igual a"},{condition:"different",text:"Diferente de"},{condition:"like",text:"Parecido com"},{condition:"includes",text:"Inclui"},{condition:"excludes",text:"Não inclui"}],a.newField={category:null,condition:null,field:null,value:null},a.selectCategory=function(b){b.fields=[];for(var c=b.sections.length-1;c>=0;c--)for(var d=b.sections[c].fields.length-1;d>=0;d--)b.fields.push(b.sections[c].fields[d]);a.newField.category=b},a.selectCondition=function(b){a.newField.condition=b},a.selectField=function(b){a.newField.field=b},a.addItem=function(){a.items.push(angular.copy(a.newField))},a.fields=[{id:128,condition:"equal_to",value:10},{id:133,condition:"equal_to",value:11}],a.save=function(){for(var c={title:"Campos",type:"fields",value:[]},d=[],e=a.items.length-1;e>=0;e--)c.value.push({id:a.items[e].field.id,condition:a.items[e].condition.condition,value:a.items[e].value}),d.push(" "+a.items[e].field.label+": "+a.items[e].condition.text+" "+a.items[e].value);c.desc=d.join(),console.log(c),a.activeAdvancedFilters.push(c),b.close()},a.close=function(){b.close()}}]})};a.loadFilter=function(b){"query"===b&&p(a.filterQuery),"category"===b&&q(),"status"===b&&r(),"author"===b&&s(),"fields"===b&&t()},a.search=function(a){j=a,o()},a.getInventoryCategory=function(b){for(var c=a.categories.length-1;c>=0;c--)if(a.categories[c].id===b)return a.categories[c];
return null},a.deleteItem=function(c,d){b.open({templateUrl:"views/inventories/items/removeItem.html",windowClass:"removeModal",resolve:{itemsList:function(){return a.items},item:function(){return c},category:function(){return d}},controller:["$scope","$modalInstance","itemsList","item","category",function(a,b,c,d,f){a.item=d,a.category=f,a.confirm=function(){var d=e.one("inventory").one("categories",a.category.id).one("items",a.item.id).remove();d.then(function(){b.close(),a.showMessage("ok","O Inventário "+a.item.title+" foi removido com sucesso","success",!0),c.splice(c.indexOf(a.item),1)})},a.close=function(){b.close()}}]})}}]).controller("InventoriesCategoriesCtrl",["$scope","Restangular","$modal",function(a,b,c){a.loading=!0;var d=b.one("inventory").all("categories").getList();d.then(function(b){a.categories=b.data,a.loading=!1}),a.deleteCategory=function(d){c.open({templateUrl:"views/inventories/removeCategory.html",windowClass:"removeModal",resolve:{inventoriesCategoriesList:function(){return a.categories}},controller:["$scope","$modalInstance","inventoriesCategoriesList",function(a,c,e){a.category=d,a.confirm=function(){var d=b.one("inventory").one("categories",a.category.id).remove();d.then(function(){c.close(),e.splice(e.indexOf(a.category),1)})},a.close=function(){c.close()}}]})}}]).controller("InventoriesCategoriesEditCtrl",["$scope","$routeParams","Restangular","$q","$modal","$window",function(a,b,c,d,e,f){var g=a.updating=!1,h=b.categoryId;if("undefined"!=typeof h&&(g=!0,a.updating=!0),a.unsavedCategory=!1,a.currentTab="fields",a.availableInputs=[{kind:"text",name:"Campo de texto",multipleOptions:!1},{kind:"integer",name:"Campo numérico",multipleOptions:!1},{kind:"decimal",name:"Campo decimal",multipleOptions:!1},{kind:"checkbox",name:"Campo de múltipla escolha",multipleOptions:!0},{kind:"radio",name:"Campo de escolha única",multipleOptions:!0},{kind:"meters",name:"Campo em metros",multipleOptions:!1},{kind:"centimeters",name:"Campo em centímetros",multipleOptions:!1},{kind:"kilometers",name:"Campo em quilômetros",multipleOptions:!1},{kind:"years",name:"Campo em anos",multipleOptions:!1},{kind:"months",name:"Campo em meses",multipleOptions:!1},{kind:"days",name:"Campo em dias",multipleOptions:!1},{kind:"hours",name:"Campo em horas",multipleOptions:!1},{kind:"seconds",name:"Campo em segundos",multipleOptions:!1},{kind:"angle",name:"Campo de ângulo",multipleOptions:!1},{kind:"date",name:"Campo de data",multipleOptions:!1},{kind:"time",name:"Campo de tempo",multipleOptions:!1},{kind:"cpf",name:"Campo de CPF",multipleOptions:!1},{kind:"cnpj",name:"Campo de CNPJ",multipleOptions:!1},{kind:"url",name:"Campo de URL",multipleOptions:!1},{kind:"email",name:"Campo de e-mail",multipleOptions:!1},{kind:"images",name:"Campo de imagens",multipleOptions:!1}],a.kindHasMultipleOptions=function(b){for(var c=a.availableInputs.length-1;c>=0;c--)if(a.availableInputs[c].kind===b)return a.availableInputs[c].multipleOptions===!0;return!1},a.loading=!0,a.category={},g){var i=c.one("inventory").one("categories",h).get({display_type:"full"}),j=c.all("groups").getList();d.all([j,i]).then(function(b){a.groups=b[0].data,a.category=b[1].data,a.$watch("category",function(b,c){b!==c&&(a.unsavedCategory=!0)},!0),a.loading=!1})}else a.loading=!1,a.$watch("category",function(b,c){b!==c&&(a.unsavedCategory=!0)},!0);f.onbeforeunload=function(){return a.unsavedCategory===!0?"Você tem certeza que deseja sair? Há alterações que não foram salvas.":null},a.editStatus=function(a){e.open({templateUrl:"views/inventories/editStatus.html",windowClass:"editInventoryStatusesModal",resolve:{status:function(){return a}},controller:["$scope","$modalInstance","status",function(a,b,c){a.status=c,a.close=function(){b.close()}}]})},a.newSection=function(){var b={title:"Nova seção sem título",required:!1,location:!1,fields:[]};a.category.sections.push(b),$("html, body").animate({scrollTop:$(document).height()},"slow")},a.newStatus=function(){var b={title:"Novo estado sem título",color:"#259ECB"},c=a.category.statuses.push(b);a.editStatus(a.category.statuses[c-1])},a.removeStatus=function(b){a.category.statuses.splice(a.category.statuses.indexOf(b),1)},a.$on("hidePopovers",function(b,c){a.$broadcast("hideOpenPopovers",c)}),a.send=function(){if(a.processingForm=!0,g){var b={title:a.category.title,require_item_status:a.category.require_item_status,statuses:a.category.statuses},e={sections:a.category.sections},f=c.one("inventory").one("categories",h).customPUT(b),i=c.one("inventory").one("categories",h).one("form").customPUT(e);d.all([f,i]).then(function(){a.showMessage("ok","A categoria de inventário foi atualizada com sucesso!","success",!0),a.unsavedCategory=!1,a.processingForm=!1},function(){a.showMessage("exclamation-sign","O item não pode ser criado. Por favor, revise os erros.","error",!0),a.processingForm=!1})}}}]).controller("InventoriesCategoriesSelectCtrl",["$scope","Restangular",function(a,b){a.loading=!0;var c=b.one("inventory").all("categories").getList();c.then(function(b){a.categories=b.data,a.loading=!1})}]).controller("InventoriesCategoriesItemEditCtrl",["$routeParams","$scope","Restangular","$q","$location","$modal","$rootScope","$fileUploader",function(a,b,c,d,e,f,g,h){var i=b.updating=!1,j=a.categoryId,k=a.id,l=b.itemData={};"undefined"!=typeof k&&(i=!0,b.updating=!0),b.loading=!0,b.hiddenFields=[],b.imagesFieldId=null;var m=b.latLngIds=[];b.item={inventory_status_id:null};var n=b.uploader=h.create({scope:b});n.filters.push(function(a){var b=n.isHTML5?a.type:"/"+a.value.slice(a.value.lastIndexOf(".")+1);return b="|"+b.toLowerCase().slice(b.lastIndexOf("/")+1)+"|",-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)});var o=c.one("inventory").one("categories",j).get({display_type:"full"});if(o.then(function(a){b.category=a.data;for(var c=b.category.sections.length-1;c>=0;c--)for(var d=b.category.sections[c].fields.length-1;d>=0;d--){var e=b.category.sections[c];if("undefined"!=typeof e){if(l[e.fields[d].id]=null,"checkbox"===e.fields[d].kind){var f={};if(null!==e.fields[d].available_values)for(var g=e.fields[d].available_values.length-1;g>=0;g--)f[e.fields[d].available_values[g]]=!1;l[e.fields[d].id]=f}e.location===!0&&("latitude"===e.fields[d].title&&(b.latLngIds[0]=e.fields[d].id,b.hiddenFields.push(e.fields[d].id)),"longitude"===e.fields[d].title&&(b.latLngIds[1]=e.fields[d].id,b.hiddenFields.push(e.fields[d].id))),"images"===e.fields[d].kind&&(b.imagesFieldId=e.fields[d].id)}}}),i){var p=c.one("inventory").one("categories",a.categoryId).one("items",a.id).get();d.all([p,o]).then(function(a){b.item=a[0].data;var c=function(a){for(var c=b.item.data.length-1;c>=0;c--)if(b.item.data[c].field.id==a)return b.item.data[c].content};for(var d in l){var e=c(d);if(e instanceof Array)for(var f=e.length-1;f>=0;f--)l[d][e[f]]=!0;else l[d]=e}b.loading=!1})}else o.then(function(){b.loading=!1});b.openMapModal=function(){var a=f.open({templateUrl:"views/inventories/items/modalMap.html",windowClass:"mapModal",resolve:{category:function(){var a=d.defer();return b.$watch("loading",function(){b.loading===!1&&a.resolve(b.category)}),a.promise}},controller:["$scope","$modalInstance","category",function(a,b,c){a.updating=i,a.category=c,a.latLng=[l[m[0]],l[m[1]]],a.close=function(){b.close()},a.save=function(){l[m[0]]=a.latLng[0],l[m[1]]=a.latLng[1],b.close()}}]});a.opened.then(function(){setTimeout(function(){g.selectLatLngMap.start()},80)})},b.send=function(){function a(a){var b=d.defer(),c=new FileReader;return c.addEventListener("load",function(a){var c=a.target;f.push(c.result.replace(/^data:image\/[^;]+;base64,/,"")),b.resolve()}),c.readAsDataURL(a),b.promise}b.processingForm=!0;for(var f=[],g=[],h=n.queue.length-1;h>=0;h--)g.push(a(n.queue[h].file));d.all(g).then(function(){var a={inventory_status_id:b.item.inventory_status_id,data:{}};for(var d in l)if(null!==l[d])if("object"==typeof l[d]){var g=[];for(var h in l[d])l[d][h]===!0&&g.push(h);a.data[d]=g}else a.data[d]=l[d];if(null!==b.imagesFieldId&&(a.data[b.imagesFieldId]=f),i){var m=c.one("inventory").one("categories",j).one("items",k).customPUT(a);m.then(function(){b.showMessage("ok","O item foi atualizado com sucesso!","success",!0),b.processingForm=!1},function(a){b.showMessage("exclamation-sign","O item não pode ser criado. Por favor, revise os erros.","error",!0),b.inputErrors=a.data.error,b.processingForm=!1})}else{var n=c.one("inventory").one("categories",j).post("items",a);n.then(function(){b.showMessage("ok","O item foi criado com sucesso","success",!0),e.path("/inventories")},function(a){b.showMessage("exclamation-sign","O item não pode ser criado. Por favor, revise os erros.","error",!0),b.inputErrors=a.data.error,b.processingForm=!1})}})}}]).controller("InventoriesCategoriesItemCtrl",["$scope","Restangular","$routeParams","$q","$location","$modal",function(a,b,c,d,e,f){a.loading=!0;var g=b.one("inventory").one("categories",c.categoryId).one("items",c.id).get(),h=b.one("inventory").one("categories",c.categoryId).get({display_type:"full"});d.all([g,h]).then(function(b){a.item=b[0].data,a.category=b[1].data,a.loading=!1}),a.getDataByInventoryFieldId=function(b){for(var c=a.item.data.length-1;c>=0;c--)if(a.item.data[c].field.id===b)return a.item.data[c].content},a.deleteItem=function(a,c){f.open({templateUrl:"views/inventories/items/removeItem.html",windowClass:"removeModal",resolve:{item:function(){return a},category:function(){return c}},controller:["$scope","$modalInstance","item","category",function(a,c,d,f){a.item=d,a.category=f,a.confirm=function(){var d=b.one("inventory").one("categories",a.category.id).one("items",a.item.id).remove();d.then(function(){c.close(),e.path("/inventories")})},a.close=function(){c.close()}}]})}}]),angular.module("zupPainelApp").controller("FlowsCtrl",["$scope","Restangular","$modal",function(a,b,c){a.loading=!1,a.loadingPagination=!1,a.loadingContent=!1,a.addFlow=function(){c.open({templateUrl:"views/flows/addFlow.html",windowClass:"addFlowModal"})},a.editStep=function(){c.open({templateUrl:"views/flows/editStep.html",windowClass:"editStepModal"})},a.addStep=function(){c.open({templateUrl:"views/flows/addStep.html",windowClass:"editStepModal"})}}]),angular.module("zupPainelApp").directive("bootstrapSwitch",function(){return{link:function(a,b){b.bootstrapSwitch()}}}),angular.module("zupPainelApp").controller("TagsCtrl",["$scope","$modal",function(a,b){a.open=function(){b.open({templateUrl:"addTag.html",windowClass:"tagModal",controller:["$scope","$modalInstance",function(a,b){a.ok=function(){b.close()}}]})}}]),angular.module("zupPainelApp").service("User",["$q","$http","Auth",function(a,b,c){return function(d,e){this.auth=function(){var f=a.defer(),g=b({method:"POST",url:"{base_url}/authenticate.json",data:{email:d,password:e},expectedErrors:[400,401]});return g.success(function(a){c.saveUser(a.user),c.saveToken(a.token),f.resolve()}),g.error(function(a,b,c,d){f.reject({data:a,status:b,config:d})}),f.promise}}}]),angular.module("zupPainelApp").factory("Auth",["$q","$http","$cookies","$rootScope",function(a,b,c,d){var e=null;return{check:function(){var c=a.defer(),d=this.getToken();if(null!==d&&null===e){var f=b({method:"GET",url:"{base_url}/me.json",headers:{"X-App-Token":d}}),g=this;f.success(function(a){g.saveUser(a.user),c.resolve()}),f.error(function(){c.reject(),g.clearToken()})}else null!==d&&null!==e?c.resolve():(c.reject(),this.clearToken());return c.promise},getToken:function(){var a=c.token;return"undefined"==typeof a?null:a},saveToken:function(a){c.token=a},clearToken:function(){delete c.token},saveUser:function(a){e=a,d.me=e},isLogged:function(){return null!==e&&null!==this.getToken()}}}]),angular.module("zupPainelApp").factory("Error",["$modal",function(a){return{showDetails:function(b){a.open({templateUrl:"views/modal_error.html",resolve:{response:function(){return b}},controller:["$scope","$modalInstance","response",function(a,b,c){a.response=c,a.ok=function(){window.location.reload()}}]})}}}]),angular.module("zupPainelApp").factory("Groups",["$resource",function(a){return a("{base_url}/groups/:id.json",{id:"@id"},{update:{method:"PUT"},getAll:{method:"GET"},getUsers:{url:"{base_url}/groups/:id/users.json",method:"GET",params:{id:"@id"}}})}]),angular.module("zupPainelApp").factory("Users",["$resource",function(a){return a("{base_url}/users/:id.json",{id:"@id"},{update:{method:"PUT"},getAll:{method:"GET"}})}]),angular.module("zupPainelApp").directive("hackSidebarHeight",function(){return{link:function(a){a.$watch(function(){return angular.element(document).height()},function(){})}}}),angular.module("zupPainelApp").factory("Reports",["$resource",function(a){return a("{base_url}/reports/categories/:id.json",{id:"@id"},{getItemsByCategory:{url:"{base_url}/reports/:categoryId/items.json",method:"GET",params:{categoryId:"@categoryId"}},getItem:{url:"{base_url}/reports/items/:id.json",params:{id:"@id"}},getItems:{url:"{base_url}/reports/items/:id.json",method:"GET",params:{id:"@id"}},save:{url:"{base_url}/reports/:categoryId/items.json",method:"POST",params:{categoryId:"@categoryId"}},getMyItems:{url:"{base_url}/reports/users/me/items.json",method:"GET"},getReportsByItem:{url:"{base_url}/reports/inventory/:itemId/items.json",method:"GET",params:{itemId:"@itemId"}},getStats:{url:"{base_url}/reports/stats.json",method:"GET"}})}]),angular.module("zupPainelApp").directive("keyboardPoster",["$parse","$timeout",function(a,b){var c=700;return function(d,e,f){var g=angular.element(e)[0],h=null;g.onkeydown=function(){var g=a(f.keyboardPoster),i=g(d);h&&b.cancel(h),h=b(function(){i(e.val())},c)}}}]),angular.module("zupPainelApp").factory("Inventories",["$resource",function(a){return a("{base_url}/inventory/categories/:id.json",{id:"@id",display_type:"full"},{getItems:{url:"{base_url}/inventory/items/:id.json",method:"GET",params:{id:"@id"}},getItem:{url:"{base_url}/inventory/categories/:categoryId/items/:id.json",method:"GET",params:{id:"@id",categoryId:"@categoryId"}},deleteItem:{url:"{base_url}/inventory/categories/:categoryId/items/:id.json",method:"DELETE",params:{id:"@id",categoryId:"@categoryId"}}})}]),angular.module("zupPainelApp").directive("mapShowItem",["$timeout","$q","$rootScope","Inventories","$compile",function(a,b,c,d,e){return{restrict:"A",link:function(a,b){var c={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},map:null,start:function(){var d=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(b[0],this.options.map),this.map.mapTypes.set("zup",d),this.map.setMapTypeId("zup"),a.$watch("loading",function(){"undefined"!=typeof a.item&&setTimeout(function(){google.maps.event.trigger(c.map,"resize"),google.maps.event.trigger(c.map,"bounds_changed"),c.map.setCenter(c.options.homeLatlng),c.addMarker(a.item,a.category)},80)})},addMarker:function(b,d){var f=new google.maps.LatLng(b.position.latitude,b.position.longitude),g=c.infoWindow,h=new google.maps.Size(15,15),i=new google.maps.MarkerImage(d.pin.retina.web,null,null,null,h),j={position:f,map:this.map,icon:i,category:d,item:b},k=new google.maps.Marker(j);this.map.setCenter(f),google.maps.event.addListener(k,"click",function(){var b="<div class=\"pinTooltip\"><h1>{{category.title}}</h1><p>Enviada {{ item.created_at | date: 'dd/MM/yy HH:mm'}}</p></div>",d=a.$new(!0);d.category=this.category,d.item=this.item;var f=e(b)(d);d.$apply(),g.setContent(f[0]),g.open(c.map,this)})}};c.start()}}}]),angular.module("zupPainelApp").directive("genericInput",function(){return{restrict:"A",link:function(a,b){a.$watch("inputErrors",function(){var c=a.inputErrors,d=$(b).closest(".form-group");if(b.removeClass("has-error"),d.removeClass("has-error"),"undefined"!=typeof c)for(var e in c)e===b.attr("name")&&(b.addClass("has-error"),d.addClass("has-error"))}),a.$parent.$watch("processingForm",function(){a.$parent.processingForm===!0?b.attr("disabled",!0):b.attr("disabled",!1)})}}}),angular.module("zupPainelApp").filter("formatErrors",["$sce","$filter",function(a,b){return function(c){var d=[];for(var e in c)for(var f=0;f<c[e].length;f++){var g=b("translateErrors")(e),h=g.charAt(0).toUpperCase()+g.slice(1);d.push(h+" "+b("translateErrors")(c[e][f]))}return a.trustAsHtml(d.join("<br>"))}}]),angular.module("zupPainelApp").directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]),angular.module("zupPainelApp").directive("map",["$compile","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){var f={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:11,mapTypeControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}},zoomLevels:{},currentZoom:11,map:null,getNewItemsTimeout:null,hideNotVisibleMarkersTimeout:null,doAnimation:!0,activeMethod:"reports",activeInventoryFilters:[],hiddenReportsCategories:[],hiddenInventoryCategories:[],infoWindow:new google.maps.InfoWindow,currentReportFilterStatus:null,start:function(){f.resize(),this.createMap(),this.setListeners()},createMap:function(){var a=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(d[0],this.options.map),this.map.mapTypes.set("zup",a),this.map.setMapTypeId("zup"),this.map.setCenter(this.options.homeLatlng)},resize:function(){d.css({height:$(window).height()-362})},setListeners:function(){google.maps.event.addListener(this.map,"bounds_changed",function(){f.boundsChanged()}),c.$on("updateMap",function(){f.boundsChanged(!0)}),$(window).resize(function(){f.resize()})},boundsChanged:function(a){var d=!1;"undefined"==typeof this.zoomLevels[this.map.getZoom()]&&(this.zoomLevels[this.map.getZoom()]={}),this.currentZoom!==this.map.getZoom()&&(d=!0,this.currentZoom=this.map.getZoom()),this.hideNotVisibleMarkersTimeout&&b.cancel(this.hideNotVisibleMarkersTimeout),this.hideNotVisibleMarkersTimeout=b(function(){f.hideNotVisibleMarkers()},200),this.getNewItemsTimeout&&b.cancel(this.getNewItemsTimeout),c.isLoadingItems=!0,this.getNewItemsTimeout=b(function(){var b=c.getData(!1,{position:{latitude:f.map.getCenter().lat(),longitude:f.map.getCenter().lng(),distance:f.getDistance()},zoom:f.map.getZoom(),limit:100});b.then(function(b){c.isLoadingItems=!1,a===!0&&f.removeAllMarkers(),d&&f.hideAllMarkersFromInactiveLevels();for(var e=b.data.length-1;e>=0;e--)f.addMarker(b.data[e],f.doAnimation);f.doAnimation===!0&&(f.doAnimation=!1)})},1e3)},hideNotVisibleMarkers:function(){angular.forEach(this.zoomLevels[this.map.getZoom()],function(a){if(f.isMarkerInsideBounds(a)){var b;"report"===e.mapCategory&&(b=f.hiddenReportsCategories.indexOf(a.item.category_id)),"inventory"===e.mapCategory&&(b=f.hiddenInventoryCategories.indexOf(a.item.inventory_category_id)),~b||a.setVisible(!0)}else a.setVisible(!1)})},hideAllMarkersFromInactiveLevels:function(){angular.forEach(this.zoomLevels,function(a,b){b!==f.currentZoom&&angular.forEach(a,function(a){a.setVisible(!1)})})},removeAllMarkers:function(){angular.forEach(this.zoomLevels,function(a,b){angular.forEach(a,function(a,c){a.setMap(null),delete f.zoomLevels[b][c]})})},isMarkerInsideBounds:function(a){return this.map.getBounds().contains(a.getPosition())},addMarker:function(b,d,g){if("undefined"==typeof this.zoomLevels[this.map.getZoom()][g+"_"+b.id]){var h,i,j,k=new google.maps.LatLng(b.position.latitude,b.position.longitude),l=f.infoWindow,m=!1;if("report"===e.mapCategory){h=c.getReportCategory(b.category_id),i=new google.maps.Size(54,51);var n=f.hiddenReportsCategories.indexOf(b.category_id);~n||(m=!0)}else{h=c.getInventoryCategory(b.inventory_category_id),i=new google.maps.Size(54,51);var n=f.hiddenInventoryCategories.indexOf(b.inventory_category_id);~n||(m=!0)}var o=new google.maps.MarkerImage(h.marker.retina.web,null,null,null,i),p={position:k,map:this.map,icon:o,category:h,item:b};"undefined"!=typeof d&&d===!0&&(p.animation=google.maps.Animation.DROP);var q=new google.maps.Marker(p);m||q.setVisible(!1),this.zoomLevels[this.map.getZoom()][g+"_"+b.id]=q,google.maps.event.addListener(q,"click",function(){var b;b="report"===e.mapCategory?'<div class="pinTooltip"><h1>{{category.title}}</h1><p>Enviada {{ item.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="#/reports/categories/{{ category.id }}/item/{{ item.id }}">Ver detalhes</a></div>':'<div class="pinTooltip"><h1>{{category.title}}</h1><p>Enviada {{ item.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="#/inventories/categories/{{ category.id }}/item/{{ item.id }}">Ver detalhes</a></div>';var d=c.$new(!0);d.category=this.category,d.item=this.item,d.view=j;var g=a(b)(d);d.$apply(),l.setContent(g[0]),l.open(f.map,this)})}},getDistance:function(){var a=this.map.getBounds(),b=a.getCenter(),c=a.getNorthEast(),d=google.maps.geometry.spherical.computeDistanceBetween(b,c);return d}};f.start(),c.map=f.map}}}]),angular.module("zupPainelApp").directive("searchMap",function(){return{restrict:"A",link:function(a,b){a.$watch("map",function(){if("undefined"!=typeof a.map){var c=a.map,d={types:["geocode"],componentRestrictions:{country:"br"}},e=new google.maps.places.SearchBox(b[0],d);e.bindTo("bounds",c);var f=new google.maps.Marker({map:c});google.maps.event.addListener(e,"places_changed",function(){f.setVisible(!1);var a=e.getPlaces()[0];a.geometry&&(a.geometry.viewport?c.fitBounds(a.geometry.viewport):(c.setCenter(a.geometry.location),c.setZoom(17)),f.setIcon({url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),f.setPosition(a.geometry.location),f.setVisible(!0))});var g=c.getStreetView();google.maps.event.addListener(g,"visible_changed",function(){g.getVisible()?b.hide():b.show()})}})}}}),angular.module("zupPainelApp").filter("translateErrors",function(){return function(a){var b={"is missing":"não pode estar em branco",statuses:"status de relatos",title:"título",icon:"ícone",marker:"marcador",color:"Cor"};return"undefined"!=typeof b[a]?b[a]:a}}),angular.module("zupPainelApp").directive("mapShowReport",["$timeout","$q","$rootScope","$compile",function(a,b,c,d){return{restrict:"A",link:function(a,b){var c={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},infoWindow:new google.maps.InfoWindow,map:null,start:function(){var d=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(b[0],this.options.map),this.map.mapTypes.set("zup",d),this.map.setMapTypeId("zup"),a.$watch("loading",function(){"undefined"!=typeof a.report&&setTimeout(function(){google.maps.event.trigger(c.map,"resize"),google.maps.event.trigger(c.map,"bounds_changed"),c.map.setCenter(c.options.homeLatlng),c.addMarker(a.report,a.category)},80)})},addMarker:function(b,e){var f=new google.maps.LatLng(b.position.latitude,b.position.longitude),g=c.infoWindow,h=new google.maps.Size(54,51),i=new google.maps.MarkerImage(e.marker.retina.web,null,null,null,h),j={position:f,map:this.map,icon:i,category:e,report:b},k=new google.maps.Marker(j);this.map.setCenter(f),google.maps.event.addListener(k,"click",function(){var b="<div class=\"pinTooltip\"><h1>{{category.title}}</h1><p>Enviada {{ report.created_at | date: 'dd/MM/yy HH:mm'}}</p></div>",e=a.$new(!0);e.category=this.category,e.report=this.report;var f=d(b)(e);e.$apply(),g.setContent(f[0]),g.open(c.map,this)})}};c.start()}}}]),angular.module("zupPainelApp").directive("navItem",["$location",function(a){return{restrict:"A",link:function(b,c){var d=c.find("a")[0].href;b.location=a,b.$watch("location.absUrl()",function(a){a.indexOf(d)?c.removeClass("active"):c.addClass("active")})}}}]),angular.module("zupPainelApp").directive("detectScrollTop",function(){return{restrict:"A",link:function(a,b){a.$watch("scrollTop",function(){a.scrollTop===!0&&(b.animate({scrollTop:0},900),a.scrollTop=!1)})}}}),angular.module("zupPainelApp").directive("gallery",function(){return{restrict:"E",templateUrl:"views/layout/gallery.html",scope:{images:"="},replace:!0,controller:["$rootScope","$scope",function(a,b){b.$watch("images",function(){return"undefined"==typeof b.images?!1:(b.path="src",b.tileWidth=150,b.tileHeight=150,b.displayImage=function(a){b.selected=b.images.indexOf(a),b.selectedImg=a,b.showModal=!0},b.source=function(a){return"undefined"!=typeof a?a[b.path]:""},b.hasPrev=function(){return 0!==b.selected},b.hasNext=function(){return b.selected<b.images.length-1},b.next=function(){b.selected=b.selected+1,b.selectedImg=b.images[b.selected]},b.prev=function(){b.selected=b.selected-1,b.selectedImg=b.images[b.selected]},void 0)})}]}}),angular.module("zupPainelApp").directive("selectLatLngMap",["$rootScope",function(a){return{restrict:"A",link:function(b,c){var d={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},map:null,mainMarker:null,start:function(){var a=new google.maps.StyledMapType(this.options.styles,{name:"zup"});
this.map=new google.maps.Map(c[0],this.options.map),this.map.mapTypes.set("zup",a),this.map.setMapTypeId("zup");var e;b.$parent.updating===!1?e=d.options.homeLatlng:(e=new google.maps.LatLng(b.$parent.latLng[0],b.$parent.latLng[1]),d.changedMarkerPosition(b.$parent.latLng[0],b.$parent.latLng[1]));var f=new google.maps.MarkerImage(b.$parent.category.marker.retina.web,null,null,null,new google.maps.Size(54,51)),g=new google.maps.Marker({map:d.map,draggable:!0,animation:google.maps.Animation.DROP,position:e,icon:f});d.mainMarker=g,d.map.setCenter(e),google.maps.event.addListener(g,"dragend",function(){d.changedMarkerPosition(d.mainMarker.getPosition().lat(),d.mainMarker.getPosition().lng())})},changedMarkerPosition:function(a,c){var d=new google.maps.Geocoder;b.$parent.latLng=[a,c],d.geocode({latLng:new google.maps.LatLng(a,c)},function(a,c){c===google.maps.GeocoderStatus.OK&&(b.formattedAddress=a[0].formatted_address,b.$apply())})}};d.start(),a.selectLatLngMap=d}}}]),angular.module("zupPainelApp").directive("searchLatLngMap",["$rootScope",function(a){return{restrict:"A",link:function(b,c){a.$watch("selectLatLngMap",function(){if("undefined"!=typeof a.selectLatLngMap){google.maps.event.clearListeners(a.selectLatLngMap.map);var b={types:["geocode"],componentRestrictions:{country:"br"}},d=new google.maps.places.Autocomplete(c[0],b);d.bindTo("bounds",a.selectLatLngMap.map),google.maps.event.addListener(d,"place_changed",function(){var b=d.getPlace();b.geometry&&(b.geometry.viewport?a.selectLatLngMap.map.fitBounds(b.geometry.viewport):(a.selectLatLngMap.map.setCenter(b.geometry.location),a.selectLatLngMap.map.setZoom(17)),a.selectLatLngMap.mainMarker.setPosition(b.geometry.location),a.selectLatLngMap.changedMarkerPosition(b.geometry.location.lat(),b.geometry.location.lng()))})}})}}}]),angular.module("zupPainelApp").directive("onFocus",function(){return{restrict:"A",link:function(a,b,c){b.bind("focus",function(){a.$apply(c.onFocus)})}}}),angular.module("zupPainelApp").directive("onBlur",function(){return{restrict:"A",link:function(a,b,c){b.bind("blur",function(){"undefined"!=typeof c.onBlurDelay?setTimeout(function(){a.$apply(c.onBlur)},c.onBlurDelay):a.$apply(c.onBlur)})}}}),angular.module("zupPainelApp").directive("styleResultsTable",function(){return{restrict:"A",link:function(a,b){var c=function(){a.advancedSearch===!0?b.css({"margin-top":$("#advancedSearch").height()}):b.removeAttr("style")};a.$watch("advancedSearch",function(){c()}),a.$watch("activeAdvancedFilters",function(){c()},!0)}}}),angular.module("zupPainelApp").directive("droppableInputsArea",function(){return{restrict:"A",link:function(a,b){var c=null,d=function(){b.find(".input").each(function(){$(this).scope().field.position=$(this).index()}),a.$apply()};b.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para adicionar</p></div>')},update:function(){}},receive:function(a,b){var d=b.item.attr("name"),e={kind:d,label:"Novo "+d,title:null,location:!1,maximum:null,minimum:null,required:!1,size:"M",inventory_fields_can_view:[],inventory_fields_can_edit:[],position:null};c=e},update:function(b,d){var e=$(d.item).index();if(null!==c){$(this).find(".item").remove(),c.position=e;for(var f=a.section.fields.length-1;f>=0;f--)a.section.fields[f].position===e&&(a.section.fields[f].position=a.section.fields[f].position+.5);a.section.fields.push(c),a.$apply(),c=null}},start:function(a,b){$(b.helper).addClass("helper"),d()},stop:function(a,b){$(b.item).removeClass("helper"),d()}})}}}),angular.module("zupPainelApp").directive("draggableInput",function(){return{restrict:"A",link:function(a,b){b.draggable({connectToSortable:".droppableInputsArea",revert:"invalid",helper:function(){return $('<div class="customDraggableHelper">'+b.find("p").html()+"</div>")},start:function(a,b){$(b.helper).css("width","auto").css("height","auto")}})}}}),angular.module("zupPainelApp").directive("inputsSidebar",function(){return{restrict:"A",link:function(a,b){b.affix({offset:{top:75}})}}}),angular.module("zupPainelApp").directive("inventoryPopover",function(){return{restrict:"A",link:function(a){a.popover={permissions:!1,options:!1,remove:!1},a.$on("hideOpenPopovers",function(){for(var b in a.popover)a.popover[b]===!0&&(a.popover[b]=!1)})}}}),angular.module("zupPainelApp").directive("inventoryPopoverLink",function(){return{restrict:"A",link:function(a){a.openPopover=function(b){a.$emit("hidePopovers",!0),a.popover[b]=!0}}}}),angular.module("zupPainelApp").directive("inventorySingleValue",function(){return{restrict:"A",link:function(a){a.removeValue=function(b){var c=a.$parent.field.available_values.indexOf(b);-1!==c&&a.$parent.field.available_values.splice(c,1)}}}}),angular.module("zupPainelApp").directive("inventoryCreateValue",function(){return{restrict:"A",link:function(a){var b=1;a.newValue=function(){a.field.available_values.push("Nova opção "+b),b++}}}}),angular.module("zupPainelApp").directive("sortableSections",function(){return{restrict:"A",link:function(a,b){var c=function(){b.find(".section").each(function(){$(this).scope().section.position=$(this).index()}),a.$apply()};b.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para re-ordenar</p></div>')},update:function(){}},start:function(a,b){$(b.helper).addClass("helper"),c()},stop:function(a,b){$(b.item).removeClass("helper"),c()}})}}}),angular.module("zupPainelApp").directive("fieldsFilterItem",function(){return{restrict:"A",link:function(a){a.changeCondition=function(b){a.item.condition=b},a.changeField=function(b){a.item.field=b},a.delete=function(){a.$parent.items.splice(a.$parent.items.indexOf(a.item),1)}}}});