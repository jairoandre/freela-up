<div class="loading" ng-show="loading"></div>

<div ng-hide="loading" class="pages-animation">
  <div class="title">
    <ul>
      <li><a href="#/groups">Grupos</a></li>
      <li><a href="#/groups/{{ group.id }}">{{ group.name }}</a></li>
      <li>Editar permissões</li>
    </ul>
  </div>

  <div class="content groups-permissions">

    <h3>Configure as permissões</h3>

    <div class="add-permission row">

      <div class="option col-xs-3">
        <div class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            {{ getTypeName(newPermission.type) || 'Selecione o tipo' }} <span class="pull-right"><span class="caret"></span></span>
          </button>

          <ul class="dropdown-menu" role="menu">
            <li ng-repeat="permissionType in availablePermissionTypes" ng-class="{ 'active': newPermission.type == permissionType.type }"><a href="" ng-click="setNewPermissionType(permissionType.type)">{{ permissionType.name }}</a></li>
          </ul>
        </div>
      </div>

      <div class="option col-xs-4">
        <div class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            {{ getPermissionName(newPermission.type, newPermission.slug) || 'Selecione a permissão' }} <span class="pull-right"><span class="caret"></span></span>
          </button>

          <ul class="dropdown-menu" role="menu" ng-show="getTypePermissions(newPermission.type)">
            <li ng-repeat="permission in getTypePermissions(newPermission.type)" ng-class="{ 'active': newPermission.slug == permission.slug }"><a href="" ng-click="newPermission.slug = permission.slug">{{ permission.name }}</a></li>
          </ul>
        </div>
      </div>

      <div class="option col-xs-3 pages-animation" ng-show="isObjectNeeded(newPermission.type, newPermission.slug)">
        <div class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            {{ (newPermission.object.name || newPermission.object.title) || 'Selecione a categoria' }} <span class="pull-right"><span class="caret"></span></span>
          </button>

          <ul class="dropdown-menu" role="menu" ng-if="newPermission.type === 'flow'">
            <li ng-repeat="flow in flows" ng-class="{ 'active': newPermission.object == flow.id }"><a href="" ng-click="newPermission.object = flow">{{ flow.title }}</a></li>
          </ul>

          <ul class="dropdown-menu" role="menu" ng-if="newPermission.type === 'group'">
            <li ng-repeat="group in groups" ng-class="{ 'active': newPermission.object == group.id }"><a href="" ng-click="newPermission.object = group">{{ group.name }}</a></li>
          </ul>

          <ul class="dropdown-menu" role="menu" ng-if="newPermission.type === 'report'">
            <li ng-repeat="category in reportsCategories" ng-class="{ 'active': newPermission.object == category.id }"><a href="" ng-click="newPermission.object = category">{{ category.title }}</a></li>
          </ul>

          <ul class="dropdown-menu" role="menu" ng-if="newPermission.type === 'inventory'">
            <li ng-repeat="category in inventoriesCategories" ng-class="{ 'active': newPermission.object == category.id }"><a href="" ng-click="newPermission.object = category">{{ category.title }}</a></li>
          </ul>

        </div>
      </div>

      <div class="option col-xs-2">
        <button type="button" class="btn btn-info btn-custom" ng-disabled="!(newPermission.type && newPermission.slug) || creatingPermission" ng-click="createPermission()">Adicionar <i class="refresh glyphicon glyphicon-refresh rotating" ng-show="creatingPermission"></i></button>
      </div>

    </div>

    <div class="permissions-list">
      <h1>Permissões adicionadas</h1>

      <table class="table custom_table">
        <thead>
          <tr>
            <td width="15%">Tipo</td>
            <td width="15%">Categoria</td>
            <td width="70%">Permissões</td>
          </tr>
        </thead>

        <tbody>
          <tr ng-repeat="permission in permissions" class="pages-animation">
            <td>{{ getTypeName(permission.permission_type) }}</td>
            <td>{{ (permission.object.title || permission.object.name) || 'Todos' }}</td>
            <td>
              <span ng-if="isString(permission.permission_names)" class="permission-name">{{ getPermissionName(permission.permission_type, permission.permission_names) }} <a href="" ng-click="removePermission(permission, permission.permission_names)"><i class="glyphicon glyphicon-remove"></i></a></span>
              <span ng-if="!isString(permission.permission_names)" ng-repeat="name in permission.permission_names track by $index" class="permission-name">{{ getPermissionName(permission.permission_type, name) }} <a href="" ng-click="removePermission(permission, name)"><i class="glyphicon glyphicon-remove"></i></span>
              <i class="refresh glyphicon glyphicon-refresh rotating refresh" ng-show="permission.removingPermission"></i>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

</div>

