<div class="title">
  <ul>
    <li><a ng-href="#/users">Usuários</a></li>
    <li><span ng-hide="updating">Novo usuário</span><span ng-show="updating">{{ user.name }}</span></li>
  </ul>
</div>

<div class="content">

  <div class="rounder_wrapper errors" ng-show="inputErrors && isArray(inputErrors)">
    <div class="alert alert-danger fade-animation">
      <p ng-bind-html="inputErrors | formatErrors"></p>
    </div>
  </div>

  <div class="rounder_wrapper errors" ng-show="inputErrors && !isArray(inputErrors)">
    <div class="alert alert-danger fade-animation">
      <p ng-bind-html="inputErrors"></p>
    </div>
  </div>

  <form ng-submit="send()" name="form" novalidate>
    <div class="form-group" ng-class="{'has-error': form.name.$dirty && form.name.$invalid}">
      <label for="form_username">Nome completo *</label>
      <input type="text" class="form-control input-lg" id="form_username" ng-model="user.name" generic-input name="name" required>
    </div>

    <div class="form-group" ng-class="{'has-error': form.birthdate.$dirty && form.birthdate.$invalid}">
      <label for="form_birthdate">Data de nascimento *</label>
      <input type="text" class="form-control input-lg" id="form_birthdate" ng-model="user.birthdate" ui-mask="99/99/9999" model-view-value="true" generic-input name="birthdate" required>
    </div>

    <div class="form-group" ng-class="{'has-error': form.email.$dirty && form.email.$invalid}">
      <label for="form_email">Email *</label>
      <input type="email" class="form-control custom_form" id="form_email" ng-model="user.email" generic-input name="email" required>
    </div>

    <div class="form-group" ng-class="{'has-error': form.address.$dirty && form.address.$invalid}">
      <label for="form_address">Endereço *</label>
      <input type="text" class="form-control custom_form" id="form_address" ng-model="user.address" generic-input name="address" required>
    </div>

    <div class="form-group" ng-class="{'has-error': form.address_additional.$dirty && form.address_additional.$invalid}">
      <label for="form_address_additional">Complemento</label>
      <input type="text" class="form-control custom_form" id="form_address_additional" ng-model="user.address_additional" generic-input name="address_additional">
    </div>

    <div class="form-group" ng-class="{'has-error': form.district.$dirty && form.city.$invalid}">
      <label for="form_district">Bairro *</label>
      <input type="text" class="form-control custom_form" id="form_district" ng-model="user.district" generic-input name="district" required>
    </div>

    <div class="form-group" ng-class="{'has-error': form.city.$dirty && form.city.$invalid}">
      <label for="form_city">Cidade *</label>
      <input type="text" class="form-control custom_form" id="form_city" ng-model="user.city" generic-input name="city">
    </div>

    <div class="form-group" ng-class="{'has-error': form.postal_code.$dirty && form.postal_code.$invalid}">
      <label for="form_postal_code">CEP *</label>
      <input type="text" class="form-control custom_form" id="form_postal_code" ng-model="user.postal_code" generic-input name="postal_code" ui-mask="99999-999" required>
    </div>

    <div class="form-group" ng-class="{'has-error': form.institution.$dirty && form.institution.$invalid}">
      <label for="form_institution">Instituto</label>
      <input type="text" class="form-control custom_form" id="form_institution" ng-model="user.institution" generic-input name="institution">
    </div>

    <div class="form-group" ng-class="{'has-error': form.position.$dirty && form.position.$invalid}">
      <label for="form_position">Cargo</label>
      <input type="text" class="form-control custom_form" id="form_position" ng-model="user.position" generic-input name="position">
    </div>

    <div class="form-group" ng-class="{'has-error': form.phone.$dirty && form.phone.$invalid}">
      <label for="form_phone">Telefone *</label>
      <input type="text" class="form-control custom_form" id="form_phone" ng-model="user.phone" generic-input name="phone" ui-mask="(99) 99999999?9" required>
    </div>

    <div class="form-group" ng-class="{'has-error': form.commercial_phone.$dirty && form.commercial_phone.$invalid}">
      <label for="form_commercial_phone">Telefone Comercial</label>
      <input type="text" class="form-control custom_form" id="form_commercial_phone" ng-model="user.commercial_phone" generic-input name="commercial_phone" ui-mask="(99) 99999999?9">
    </div>

    <div class="form-group" ng-class="{'has-error': form.document.$dirty && form.document.$invalid}">
      <label for="form_document">Documento CPF *</label>
      <input type="text" class="form-control custom_form" id="form_document" ng-model="user.document" generic-input name="document" ui-mask="999.999.999-99" ng-cpf required>
    </div>

    <hr />

    <div class="form-group" ng-class="{'has-error': form.password.$dirty && form.password.$invalid}">
      <label for="form_email">{{ updating ? 'Nova senha' : 'Senha' }} <span ng-hide="updating">*</span></label>

      <div class="row">
        <div class="col-xs-6">
          <input type="password" ng-disabled="should_generate_password" class="form-control custom_form" placeholder="Senha" ng-model="user.password" generic-input name="password" equals="{{ user.password_confirmation }}" ng-minlength="6" ng-maxlength="16" ng-required="!updating && !should_generate_password">
        </div>

        <div class="col-xs-6">
          <input type="password" ng-disabled="should_generate_password" class="form-control custom_form" placeholder="Confirmar senha" ng-model="user.password_confirmation" generic-input equals="{{ user.password }}" ng-minlength="6" ng-maxlength="16" name="password_confirmation" ng-required="!updating && !should_generate_password">
        </div>
      </div>
      <p ng-show="form.password.$error.minlength" class="help-block">A senha é muito curta.</p>
      <p ng-show="form.password.$error.maxlength" class="help-block">A senha é muito longa.</p>
    </div>

    <div class="row">
      <div class="checkbox pull-left">
        <label>
          <input type="checkbox" ng-model="should_generate_password"> Gere uma senha e envie ao usuário pelo email de cadastro
        </label>
      </div>
    </div>

    <div class="form-group pages-animation" ng-if="!hasPermission('users_full_access') && !form.password.$pristine && user.password.length !== 0 && updating">
      <label for="form_email">Senha atual *</label>
      <input type="password" class="form-control custom_form" placeholder="Senha atual" ng-model="user.current_password" generic-input name="currentPassword" ng-required="!hasPermission('users_full_access') && !form.password.$pristine && user.password.length !== 0 && !should_generate_password">
    </div>

    <hr />

    <div ng-show="hasPermission('groups_full_access') || hasPermission('users_edit') && !updating">
      <p>Por padrão, todos os usuários são adicionados ao grupo <b>Público</b>. Se desejar, você pode especificar abaixo quais grupos este novo usuário deve pertencer.</p>

      <div class="form-group">
        <label>Grupos do usuário</label>

        <groups-selector-inline groups="user.groups"></groups-selector-inline>
      </div>

      <hr />
    </div>

    <button type="submit" class="btn btn-info btn-custom btn-lg-custom" ng-hide="updating" ng-disabled="form.$invalid"><span ng-hide="processingForm">Criar usuário</span> <span ng-show="processingForm"><i class="refresh glyphicon glyphicon-refresh rotating refresh"></i></span></button>

    <button type="submit" class="btn btn-info btn-custom btn-lg-custom" ng-show="updating" ng-disabled="form.$invalid"><span ng-hide="processingForm">Atualizar usuário</span> <span ng-show="processingForm"><i class="refresh glyphicon glyphicon-refresh rotating refresh"></i></span></button>

  </form>
</div>
