<div id="main_layout">
  <div id="sidebar" hack-sidebar-height>
    <!-- Include views/layouts/menu.html -->
    <div ng-include="'views/layout/menu.html'"></div>
  </div>

  <div id="main_content">
    <!-- Include views/layouts/header.html -->
    <div ng-include="'views/layout/header.html'"></div>

    <div class="loading" ng-show="loading"></div>
    <div class="loading" ng-show="loadingContent"></div>

    <div ng-hide="loading" class="pages-animation">
      <div class="title">
        <div class="links">
          <a href="#/reports" class="active"><span class="glyphicon glyphicon-list"></span> <p>Explorar em lista</p></a>
          <a href="#/reports/map"><span class="glyphicon glyphicon-map-marker"></span> <p>Explorar no mapa</p></a>
        </div>

        <a href="#/reports/categories" class="btn btn-info btn-custom">Gerenciar categorias</a>
      </div>

      <div class="advanced_search" id="advanced_search" ng-show="advanced_search">
        <div class="col-xs-9 search_column1">
          <span class="glyphicon glyphicon-search search_icon"></span>
          <input type="text" placeholder="Busque um filtro..." on-focus="show_available_filters = true" on-blur="show_available_filters = false" on-blur-delay="20" ng-model="filter_query" style="width: 80%;" />

          <div class="clearfix"></div>

          <div class="available_filters" ng-show="show_available_filters">
            <a href="" ng-click="loadFilter('query')">Protocolo ou endereço contém...</a>
            <a href="" ng-click="loadFilter(filter.action)" ng-repeat="filter in available_filters | filter:filter_query">{{ filter.name }}</a>
          </div>

          <div class="advanced_filters_bar" ng-show="active_advanced_filters.length !== 0">
            <div class="filter" ng-repeat="filter in active_advanced_filters"><b>{{ filter.title }}</b> {{ filter.desc }} <span class="glyphicon glyphicon-remove" ng-click="removeFilter(filter)"></span></div>
          </div>

          <div class="clearfix"></div>

          <a href="" class="clear_filters" ng-show="active_advanced_filters.length !== 0" ng-click="resetFilters()"><span class="glyphicon glyphicon-remove"></span> Limpar todos os filtros</a>
        </div>

        <div class="col-xs-3 filter_change">
          <a href="" ng-click="advanced_search = false">Utilizar busca simples</a>
        </div>

        <div class="clearfix"></div>
      </div>

      <div class="simple_search" ng-hide="advanced_search">
        <div class="col-xs-9 search_column1"
          <span class="glyphicon glyphicon-search search_icon"></span>
          <input type="text" placeholder="Busque pelo endereço" keyboard-poster="search" style="width: 80%;" />
        </div>

        <div class="col-xs-3 filter_change">
          <a href="" ng-click="advanced_search = true">Utilizar busca avançada</a>
        </div>
      </div>

      <div class="middle">
        <div class="simple_filters" ng-hide="advanced_search">
          <div class="col-xs-4">
            <div class="form-group">
              <label>Nas categorias</label>

              <select class="multiple-select" ui-select2 ng-model="selectedCategories" data-placeholder="Digite uma categoria" multiple>
                <option ng-repeat="category in categories" value="{{ category.id }}">{{ category.title }}</option>
              </select>
            </div>
          </div>

          <div class="col-xs-4">
            <div class="form-group">
              <label>Com status</label>

              <select class="multiple-select" ui-select2 ng-model="selectedStatuses" data-placeholder="Digite um status" multiple>
                <option ng-repeat="status in statuses" value="{{ status.id }}">{{ status.title }}</option>
              </select>
            </div>
          </div>

          <div class="col-xs-4">
            <div class="col-xs-6">
              <div class="form-group">
                <label>No periódo</label>

                <div class="datepicker-popup">
                  <input type="text" class="form-control" datepicker-popup="dd/MM/yyyy" ng-model="beginDate" show-weeks="false" datepicker-options="dateOptions" show-button-bar="false" />
                </div>
              </div>
            </div>

            <div class="col-xs-6">
              <label>Até</label>

              <div class="datepicker-popup">
                <input type="text" class="form-control" datepicker-popup="dd/MM/yyyy" ng-model="endDate" show-weeks="false" datepicker-options="dateOptions" show-button-bar="false" />
              </div>
            </div>
          </div>

          <div class="clearfix"></div>
        </div>
      </div>

      <table class="table custom_table" infinite-scroll="getData(true)" infinite-scroll-distance="3" ng-class="{'advanced-filters-margin': advanced_search == true}" style-results-table>
        <thead>
          <tr>
            <td width="10%">Protocolo</td>
            <td width="40%">Endereço</td>
            <td>Autor</td>
            <td>Categoria</td>
            <td>Data de inclusão</td>
            <td></td>
          </tr>
        </thead>

        <tr ng-repeat="report in reports">
          <td class="status_color"><span ng-repeat="status in getReportCategory(report.category_id).statuses" ng-style="{'background-color': status.color}" ng-show="status.id == report.status_id"></span><a href="#/reports/categories/{{ report.category_id }}/item/{{ report.id }}">{{ report.protocol }}</a></td>
          <td>{{ report.address }}</td>
          <td><a href="#/users/{{ report.user.id }}">{{ report.user.name }}</a></td>
          <td>{{ getReportCategory(report.category_id).title }}</td>
          <td>{{ report.created_at | date:'dd/MM/yy HH:mm'}}</td>
          <td class="actions">
            <a class="icon_action" href="" ng-click="editReportStatus(report, getReportCategory(report.category_id))"><span class="glyphicon glyphicon-edit"></span></a>
            <a class="icon_action" href="" ng-click="deleteReport(report)"><span class="glyphicon glyphicon-trash"></span></a>
          </td>
        </tr>

      </table>

      <div class="loadingScrolling" ng-show="loadingPagination && !loadingContent"></div>
    </div>

  </div>
</div>
